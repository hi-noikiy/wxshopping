"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _defineProperty2(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}(function(f){if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.AV=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o])}return s}({1:[function(require,module,exports){},{}],2:[function(require,module,exports){var charenc={utf8:{stringToBytes:function stringToBytes(str){return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)))},bytesToString:function bytesToString(bytes){return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)))}},bin:{stringToBytes:function stringToBytes(str){for(var bytes=[],i=0;i<str.length;i++){bytes.push(str.charCodeAt(i)&0xFF)}return bytes},bytesToString:function bytesToString(bytes){for(var str=[],i=0;i<bytes.length;i++){str.push(String.fromCharCode(bytes[i]))}return str.join('')}}};module.exports=charenc},{}],3:[function(require,module,exports){if(typeof module!=='undefined'){module.exports=Emitter}function Emitter(obj){if(obj)return mixin(obj)};function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks['$'+event]=this._callbacks['$'+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks['$'+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks['$'+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks['$'+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks['$'+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],4:[function(require,module,exports){(function(){var base64map='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',crypt={rotl:function rotl(n,b){return n<<b|n>>>32-b},rotr:function rotr(n,b){return n<<32-b|n>>>b},endian:function endian(n){if(n.constructor==Number){return crypt.rotl(n,8)&0x00FF00FF|crypt.rotl(n,24)&0xFF00FF00}for(var i=0;i<n.length;i++){n[i]=crypt.endian(n[i])}return n},randomBytes:function randomBytes(n){for(var bytes=[];n>0;n--){bytes.push(Math.floor(Math.random()*256))}return bytes},bytesToWords:function bytesToWords(bytes){for(var words=[],i=0,b=0;i<bytes.length;i++,b+=8){words[b>>>5]|=bytes[i]<<24-b%32}return words},wordsToBytes:function wordsToBytes(words){for(var bytes=[],b=0;b<words.length*32;b+=8){bytes.push(words[b>>>5]>>>24-b%32&0xFF)}return bytes},bytesToHex:function bytesToHex(bytes){for(var hex=[],i=0;i<bytes.length;i++){hex.push((bytes[i]>>>4).toString(16));hex.push((bytes[i]&0xF).toString(16))}return hex.join('')},hexToBytes:function hexToBytes(hex){for(var bytes=[],c=0;c<hex.length;c+=2){bytes.push(parseInt(hex.substr(c,2),16))}return bytes},bytesToBase64:function bytesToBase64(bytes){for(var base64=[],i=0;i<bytes.length;i+=3){var triplet=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2];for(var j=0;j<4;j++){if(i*8+j*6<=bytes.length*8)base64.push(base64map.charAt(triplet>>>6*(3-j)&0x3F));else base64.push('=')}}return base64.join('')},base64ToBytes:function base64ToBytes(base64){base64=base64.replace(/[^A-Z0-9+\/]/ig,'');for(var bytes=[],i=0,imod4=0;i<base64.length;imod4=++i%4){if(imod4==0)continue;bytes.push((base64map.indexOf(base64.charAt(i-1))&Math.pow(2,-2*imod4+8)-1)<<imod4*2|base64map.indexOf(base64.charAt(i))>>>6-imod4*2)}return bytes}};module.exports=crypt})()},{}],5:[function(require,module,exports){(function(process){exports=module.exports=require('./debug');exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage='undefined'!=typeof chrome&&'undefined'!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=['lightseagreen','forestgreen','goldenrod','dodgerblue','darkorchid','crimson'];function useColors(){return typeof document!=='undefined'&&'WebkitAppearance'in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?'%c':'')+this.namespace+(useColors?' %c':' ')+args[0]+(useColors?'%c ':' ')+'+'+exports.humanize(this.diff);if(!useColors)return args;var c='color: '+this.color;args=[args[0],c,'color: inherit'].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if('%%'===match)return;index++;if('%c'===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return'object'===(typeof console==="undefined"?"undefined":_typeof(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem('debug')}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}if('env'in(typeof process==='undefined'?{}:process)){r=process.env.DEBUG}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}}).call(this,require('_process'))},{"./debug":6,"_process":15}],6:[function(require,module,exports){exports=module.exports=debug.debug=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require('ms');exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date();var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}args[0]=exports.coerce(args[0]);if('string'!==typeof args[0]){args=['%o'].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==='%%')return match;index++;var formatter=exports.formatters[format];if('function'===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});args=exports.formatArgs.apply(self,args);var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||'').split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/[\\^$+?.()|[\]{}]/g,'\\$&').replace(/\*/g,'.*?');if(namespaces[0]==='-'){exports.skips.push(new RegExp('^'+namespaces.substr(1)+'$'))}else{exports.names.push(new RegExp('^'+namespaces+'$'))}}}function disable(){exports.enable('')}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{"ms":14}],7:[function(require,module,exports){"use strict";var createUniqueKey=exports.createUniqueKey=typeof Symbol!=="undefined"?Symbol:function createUniqueKey(name){return"[["+name+"_"+Math.random().toFixed(8).slice(2)+"]]"};exports.LISTENERS=createUniqueKey("listeners");exports.CAPTURE=1;exports.BUBBLE=2;exports.ATTRIBUTE=3;exports.newNode=function newNode(listener,kind){return{listener:listener,kind:kind,next:null}}},{}],8:[function(require,module,exports){"use strict";var Commons=require("./commons");var LISTENERS=Commons.LISTENERS;var ATTRIBUTE=Commons.ATTRIBUTE;var newNode=Commons.newNode;function getAttributeListener(eventTarget,type){var node=eventTarget[LISTENERS][type];while(node!=null){if(node.kind===ATTRIBUTE){return node.listener}node=node.next}return null}function setAttributeListener(eventTarget,type,listener){if(typeof listener!=="function"&&(typeof listener==="undefined"?"undefined":_typeof(listener))!=="object"){listener=null}var prev=null;var node=eventTarget[LISTENERS][type];while(node!=null){if(node.kind===ATTRIBUTE){if(prev==null){eventTarget[LISTENERS][type]=node.next}else{prev.next=node.next}}else{prev=node}node=node.next}if(listener!=null){if(prev==null){eventTarget[LISTENERS][type]=newNode(listener,ATTRIBUTE)}else{prev.next=newNode(listener,ATTRIBUTE)}}}exports.defineCustomEventTarget=function(EventTargetBase,types){function EventTarget(){EventTargetBase.call(this)}var descripter={constructor:{value:EventTarget,configurable:true,writable:true}};types.forEach(function(type){descripter["on"+type]={get:function get(){return getAttributeListener(this,type)},set:function set(listener){setAttributeListener(this,type,listener)},configurable:true,enumerable:true}});EventTarget.prototype=Object.create(EventTargetBase.prototype,descripter);return EventTarget}},{"./commons":7}],9:[function(require,module,exports){"use strict";var Commons=require("./commons");var CustomEventTarget=require("./custom-event-target");var EventWrapper=require("./event-wrapper");var LISTENERS=Commons.LISTENERS;var CAPTURE=Commons.CAPTURE;var BUBBLE=Commons.BUBBLE;var ATTRIBUTE=Commons.ATTRIBUTE;var newNode=Commons.newNode;var defineCustomEventTarget=CustomEventTarget.defineCustomEventTarget;var createEventWrapper=EventWrapper.createEventWrapper;var STOP_IMMEDIATE_PROPAGATION_FLAG=EventWrapper.STOP_IMMEDIATE_PROPAGATION_FLAG;var HAS_EVENTTARGET_INTERFACE=typeof window!=="undefined"&&typeof window.EventTarget!=="undefined";var EventTarget=module.exports=function EventTarget(){if(this instanceof EventTarget){Object.defineProperty(this,LISTENERS,{value:Object.create(null)})}else if(arguments.length===1&&Array.isArray(arguments[0])){return defineCustomEventTarget(EventTarget,arguments[0])}else if(arguments.length>0){var types=Array(arguments.length);for(var i=0;i<arguments.length;++i){types[i]=arguments[i]}return defineCustomEventTarget(EventTarget,types)}else{throw new TypeError("Cannot call a class as a function");}};EventTarget.prototype=Object.create((HAS_EVENTTARGET_INTERFACE?window.EventTarget:Object).prototype,{constructor:{value:EventTarget,writable:true,configurable:true},addEventListener:{value:function addEventListener(type,listener,capture){if(listener==null){return false}if(typeof listener!=="function"&&(typeof listener==="undefined"?"undefined":_typeof(listener))!=="object"){throw new TypeError("\"listener\" is not an object.");}var kind=capture?CAPTURE:BUBBLE;var node=this[LISTENERS][type];if(node==null){this[LISTENERS][type]=newNode(listener,kind);return true}var prev=null;while(node!=null){if(node.listener===listener&&node.kind===kind){return false}prev=node;node=node.next}prev.next=newNode(listener,kind);return true},configurable:true,writable:true},removeEventListener:{value:function removeEventListener(type,listener,capture){if(listener==null){return false}var kind=capture?CAPTURE:BUBBLE;var prev=null;var node=this[LISTENERS][type];while(node!=null){if(node.listener===listener&&node.kind===kind){if(prev==null){this[LISTENERS][type]=node.next}else{prev.next=node.next}return true}prev=node;node=node.next}return false},configurable:true,writable:true},dispatchEvent:{value:function dispatchEvent(event){var node=this[LISTENERS][event.type];if(node==null){return true}var wrapped=createEventWrapper(event,this);while(node!=null){if(typeof node.listener==="function"){node.listener.call(this,wrapped)}else if(node.kind!==ATTRIBUTE&&typeof node.listener.handleEvent==="function"){node.listener.handleEvent(wrapped)}if(wrapped[STOP_IMMEDIATE_PROPAGATION_FLAG]){break}node=node.next}return!wrapped.defaultPrevented},configurable:true,writable:true}})},{"./commons":7,"./custom-event-target":8,"./event-wrapper":10}],10:[function(require,module,exports){"use strict";var createUniqueKey=require("./commons").createUniqueKey;var STOP_IMMEDIATE_PROPAGATION_FLAG=createUniqueKey("stop_immediate_propagation_flag");var CANCELED_FLAG=createUniqueKey("canceled_flag");var ORIGINAL_EVENT=createUniqueKey("original_event");var wrapperPrototypeDefinition=Object.freeze({stopPropagation:Object.freeze({value:function stopPropagation(){var e=this[ORIGINAL_EVENT];if(typeof e.stopPropagation==="function"){e.stopPropagation()}},writable:true,configurable:true}),stopImmediatePropagation:Object.freeze({value:function stopImmediatePropagation(){this[STOP_IMMEDIATE_PROPAGATION_FLAG]=true;var e=this[ORIGINAL_EVENT];if(typeof e.stopImmediatePropagation==="function"){e.stopImmediatePropagation()}},writable:true,configurable:true}),preventDefault:Object.freeze({value:function preventDefault(){if(this.cancelable===true){this[CANCELED_FLAG]=true}var e=this[ORIGINAL_EVENT];if(typeof e.preventDefault==="function"){e.preventDefault()}},writable:true,configurable:true}),defaultPrevented:Object.freeze({get:function defaultPrevented(){return this[CANCELED_FLAG]},enumerable:true,configurable:true})});exports.STOP_IMMEDIATE_PROPAGATION_FLAG=STOP_IMMEDIATE_PROPAGATION_FLAG;exports.createEventWrapper=function createEventWrapper(event,eventTarget){var timeStamp=typeof event.timeStamp==="number"?event.timeStamp:Date.now();var propertyDefinition={type:{value:event.type,enumerable:true},target:{value:eventTarget,enumerable:true},currentTarget:{value:eventTarget,enumerable:true},eventPhase:{value:2,enumerable:true},bubbles:{value:Boolean(event.bubbles),enumerable:true},cancelable:{value:Boolean(event.cancelable),enumerable:true},timeStamp:{value:timeStamp,enumerable:true},isTrusted:{value:false,enumerable:true}};propertyDefinition[STOP_IMMEDIATE_PROPAGATION_FLAG]={value:false,writable:true};propertyDefinition[CANCELED_FLAG]={value:false,writable:true};propertyDefinition[ORIGINAL_EVENT]={value:event};if(typeof event.detail!=="undefined"){propertyDefinition.detail={value:event.detail,enumerable:true}}return Object.create(Object.create(event,wrapperPrototypeDefinition),propertyDefinition)}},{"./commons":7}],11:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==='function'&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==='function'&&typeof obj.slice==='function'&&isBuffer(obj.slice(0,0))}},{}],12:[function(require,module,exports){(function(root){var localStorageMemory={};var cache={};localStorageMemory.length=0;localStorageMemory.getItem=function(key){return cache[key]||null};localStorageMemory.setItem=function(key,value){if(typeof value==='undefined'){localStorageMemory.removeItem(key)}else{if(!cache.hasOwnProperty(key)){localStorageMemory.length++}cache[key]=''+value}};localStorageMemory.removeItem=function(key){if(cache.hasOwnProperty(key)){delete cache[key];localStorageMemory.length--}};localStorageMemory.key=function(index){return Object.keys(cache)[index]||null};localStorageMemory.clear=function(){cache={};localStorageMemory.length=0};if((typeof exports==="undefined"?"undefined":_typeof(exports))==='object'){module.exports=localStorageMemory}else{root.localStorageMemory=localStorageMemory}})(this)},{}],13:[function(require,module,exports){(function(){var crypt=require('crypt'),utf8=require('charenc').utf8,isBuffer=require('is-buffer'),bin=require('charenc').bin,md5=function md5(message,options){if(message.constructor==String){if(options&&options.encoding==='binary')message=bin.stringToBytes(message);else message=utf8.stringToBytes(message)}else if(isBuffer(message))message=Array.prototype.slice.call(message,0);else if(!Array.isArray(message))message=message.toString();var m=crypt.bytesToWords(message),l=message.length*8,a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(var i=0;i<m.length;i++){m[i]=(m[i]<<8|m[i]>>>24)&0x00FF00FF|(m[i]<<24|m[i]>>>8)&0xFF00FF00}m[l>>>5]|=0x80<<l%32;m[(l+64>>>9<<4)+14]=l;var FF=md5._ff,GG=md5._gg,HH=md5._hh,II=md5._ii;for(var i=0;i<m.length;i+=16){var aa=a,bb=b,cc=c,dd=d;a=FF(a,b,c,d,m[i+0],7,-680876936);d=FF(d,a,b,c,m[i+1],12,-389564586);c=FF(c,d,a,b,m[i+2],17,606105819);b=FF(b,c,d,a,m[i+3],22,-1044525330);a=FF(a,b,c,d,m[i+4],7,-176418897);d=FF(d,a,b,c,m[i+5],12,1200080426);c=FF(c,d,a,b,m[i+6],17,-1473231341);b=FF(b,c,d,a,m[i+7],22,-45705983);a=FF(a,b,c,d,m[i+8],7,1770035416);d=FF(d,a,b,c,m[i+9],12,-1958414417);c=FF(c,d,a,b,m[i+10],17,-42063);b=FF(b,c,d,a,m[i+11],22,-1990404162);a=FF(a,b,c,d,m[i+12],7,1804603682);d=FF(d,a,b,c,m[i+13],12,-40341101);c=FF(c,d,a,b,m[i+14],17,-1502002290);b=FF(b,c,d,a,m[i+15],22,1236535329);a=GG(a,b,c,d,m[i+1],5,-165796510);d=GG(d,a,b,c,m[i+6],9,-1069501632);c=GG(c,d,a,b,m[i+11],14,643717713);b=GG(b,c,d,a,m[i+0],20,-373897302);a=GG(a,b,c,d,m[i+5],5,-701558691);d=GG(d,a,b,c,m[i+10],9,38016083);c=GG(c,d,a,b,m[i+15],14,-660478335);b=GG(b,c,d,a,m[i+4],20,-405537848);a=GG(a,b,c,d,m[i+9],5,568446438);d=GG(d,a,b,c,m[i+14],9,-1019803690);c=GG(c,d,a,b,m[i+3],14,-187363961);b=GG(b,c,d,a,m[i+8],20,1163531501);a=GG(a,b,c,d,m[i+13],5,-1444681467);d=GG(d,a,b,c,m[i+2],9,-51403784);c=GG(c,d,a,b,m[i+7],14,1735328473);b=GG(b,c,d,a,m[i+12],20,-1926607734);a=HH(a,b,c,d,m[i+5],4,-378558);d=HH(d,a,b,c,m[i+8],11,-2022574463);c=HH(c,d,a,b,m[i+11],16,1839030562);b=HH(b,c,d,a,m[i+14],23,-35309556);a=HH(a,b,c,d,m[i+1],4,-1530992060);d=HH(d,a,b,c,m[i+4],11,1272893353);c=HH(c,d,a,b,m[i+7],16,-155497632);b=HH(b,c,d,a,m[i+10],23,-1094730640);a=HH(a,b,c,d,m[i+13],4,681279174);d=HH(d,a,b,c,m[i+0],11,-358537222);c=HH(c,d,a,b,m[i+3],16,-722521979);b=HH(b,c,d,a,m[i+6],23,76029189);a=HH(a,b,c,d,m[i+9],4,-640364487);d=HH(d,a,b,c,m[i+12],11,-421815835);c=HH(c,d,a,b,m[i+15],16,530742520);b=HH(b,c,d,a,m[i+2],23,-995338651);a=II(a,b,c,d,m[i+0],6,-198630844);d=II(d,a,b,c,m[i+7],10,1126891415);c=II(c,d,a,b,m[i+14],15,-1416354905);b=II(b,c,d,a,m[i+5],21,-57434055);a=II(a,b,c,d,m[i+12],6,1700485571);d=II(d,a,b,c,m[i+3],10,-1894986606);c=II(c,d,a,b,m[i+10],15,-1051523);b=II(b,c,d,a,m[i+1],21,-2054922799);a=II(a,b,c,d,m[i+8],6,1873313359);d=II(d,a,b,c,m[i+15],10,-30611744);c=II(c,d,a,b,m[i+6],15,-1560198380);b=II(b,c,d,a,m[i+13],21,1309151649);a=II(a,b,c,d,m[i+4],6,-145523070);d=II(d,a,b,c,m[i+11],10,-1120210379);c=II(c,d,a,b,m[i+2],15,718787259);b=II(b,c,d,a,m[i+9],21,-343485551);a=a+aa>>>0;b=b+bb>>>0;c=c+cc>>>0;d=d+dd>>>0}return crypt.endian([a,b,c,d])};md5._ff=function(a,b,c,d,x,s,t){var n=a+(b&c|~b&d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b};md5._gg=function(a,b,c,d,x,s,t){var n=a+(b&d|c&~d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b};md5._hh=function(a,b,c,d,x,s,t){var n=a+(b^c^d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b};md5._ii=function(a,b,c,d,x,s,t){var n=a+(c^(b|~d))+(x>>>0)+t;return(n<<s|n>>>32-s)+b};md5._blocksize=16;md5._digestsize=16;module.exports=function(message,options){if(message===undefined||message===null)throw new Error('Illegal argument '+message);var digestbytes=crypt.wordsToBytes(md5(message,options));return options&&options.asBytes?digestbytes:options&&options.asString?bin.bytesToString(digestbytes):crypt.bytesToHex(digestbytes)}})()},{"charenc":2,"crypt":4,"is-buffer":11}],14:[function(require,module,exports){var s=1000;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};var type=typeof val==="undefined"?"undefined":_typeof(val);if(type==='string'&&val.length>0){return parse(val)}else if(type==='number'&&isNaN(val)===false){return options.long?fmtLong(val):fmtShort(val)}throw new Error('val is not a non-empty string or a valid number. val='+JSON.stringify(val));};function parse(str){str=String(str);if(str.length>10000){return}var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match){return}var n=parseFloat(match[1]);var type=(match[2]||'ms').toLowerCase();switch(type){case'years':case'year':case'yrs':case'yr':case'y':return n*y;case'days':case'day':case'd':return n*d;case'hours':case'hour':case'hrs':case'hr':case'h':return n*h;case'minutes':case'minute':case'mins':case'min':case'm':return n*m;case'seconds':case'second':case'secs':case'sec':case's':return n*s;case'milliseconds':case'millisecond':case'msecs':case'msec':case'ms':return n;default:return undefined}}function fmtShort(ms){if(ms>=d){return Math.round(ms/d)+'d'}if(ms>=h){return Math.round(ms/h)+'h'}if(ms>=m){return Math.round(ms/m)+'m'}if(ms>=s){return Math.round(ms/s)+'s'}return ms+'ms'}function fmtLong(ms){return plural(ms,d,'day')||plural(ms,h,'hour')||plural(ms,m,'minute')||plural(ms,s,'second')||ms+' ms'}function plural(ms,n,name){if(ms<n){return}if(ms<n*1.5){return Math.floor(ms/n)+' '+name}return Math.ceil(ms/n)+' '+name+'s'}},{}],15:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error('setTimeout has not been defined');}function defaultClearTimeout(){throw new Error('clearTimeout has not been defined');}(function(){try{if(typeof setTimeout==='function'){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==='function'){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title='browser';process.browser=true;process.env={};process.argv=[];process.version='';process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error('process.binding is not supported');};process.cwd=function(){return'/'};process.chdir=function(dir){throw new Error('process.chdir is not supported');};process.umask=function(){return 0}},{}],16:[function(require,module,exports){(function(process,global){(function(global,factory){(typeof exports==="undefined"?"undefined":_typeof(exports))==='object'&&typeof module!=='undefined'?factory(exports):typeof define==='function'&&define.amd?define(['exports'],factory):factory(global.RSVP=global.RSVP||{})})(this,function(exports){'use strict';function indexOf(callbacks,callback){for(var i=0,l=callbacks.length;i<l;i++){if(callbacks[i]===callback){return i}}return-1}function callbacksFor(object){var callbacks=object._promiseCallbacks;if(!callbacks){callbacks=object._promiseCallbacks={}}return callbacks}var EventTarget={mixin:function mixin(object){object['on']=this['on'];object['off']=this['off'];object['trigger']=this['trigger'];object._promiseCallbacks=undefined;return object},on:function on(eventName,callback){if(typeof callback!=='function'){throw new TypeError('Callback must be a function');}var allCallbacks=callbacksFor(this),callbacks=undefined;callbacks=allCallbacks[eventName];if(!callbacks){callbacks=allCallbacks[eventName]=[]}if(indexOf(callbacks,callback)===-1){callbacks.push(callback)}},off:function off(eventName,callback){var allCallbacks=callbacksFor(this),callbacks=undefined,index=undefined;if(!callback){allCallbacks[eventName]=[];return}callbacks=allCallbacks[eventName];index=indexOf(callbacks,callback);if(index!==-1){callbacks.splice(index,1)}},trigger:function trigger(eventName,options,label){var allCallbacks=callbacksFor(this),callbacks=undefined,callback=undefined;if(callbacks=allCallbacks[eventName]){for(var i=0;i<callbacks.length;i++){callback=callbacks[i];callback(options,label)}}}};var config={instrument:false};EventTarget['mixin'](config);function configure(name,value){if(name==='onerror'){config['on']('error',value);return}if(arguments.length===2){config[name]=value}else{return config[name]}}function objectOrFunction(x){return typeof x==='function'||(typeof x==="undefined"?"undefined":_typeof(x))==='object'&&x!==null}function isFunction(x){return typeof x==='function'}function isMaybeThenable(x){return(typeof x==="undefined"?"undefined":_typeof(x))==='object'&&x!==null}var _isArray=undefined;if(!Array.isArray){_isArray=function _isArray(x){return Object.prototype.toString.call(x)==='[object Array]'}}else{_isArray=Array.isArray}var isArray=_isArray;var now=Date.now||function(){return new Date().getTime()};function F(){}var o_create=Object.create||function(o){if(arguments.length>1){throw new Error('Second argument not supported');}if((typeof o==="undefined"?"undefined":_typeof(o))!=='object'){throw new TypeError('Argument must be an object');}F.prototype=o;return new F()};var queue=[];function scheduleFlush(){setTimeout(function(){for(var i=0;i<queue.length;i++){var entry=queue[i];var payload=entry.payload;payload.guid=payload.key+payload.id;payload.childGuid=payload.key+payload.childId;if(payload.error){payload.stack=payload.error.stack}config['trigger'](entry.name,entry.payload)}queue.length=0},50)}function instrument(eventName,promise,child){if(1===queue.push({name:eventName,payload:{key:promise._guidKey,id:promise._id,eventName:eventName,detail:promise._result,childId:child&&child._id,label:promise._label,timeStamp:now(),error:config["instrument-with-stack"]?new Error(promise._label):null}})){scheduleFlush()}}function resolve$1(object,label){var Constructor=this;if(object&&(typeof object==="undefined"?"undefined":_typeof(object))==='object'&&object.constructor===Constructor){return object}var promise=new Constructor(noop,label);resolve(promise,object);return promise}function withOwnPromise(){return new TypeError('A promises callback cannot return that same promise.')}function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var GET_THEN_ERROR=new ErrorObject();function getThen(promise){try{return promise.then}catch(error){GET_THEN_ERROR.error=error;return GET_THEN_ERROR}}function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then){config.async(function(promise){var sealed=false;var error=tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){resolve(promise,value,undefined)}else{fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;reject(promise,reason)},'Settle: '+(promise._label||' unknown promise'));if(!sealed&&error){sealed=true;reject(promise,error)}},promise)}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result)}else if(thenable._state===REJECTED){thenable._onError=null;reject(promise,thenable._result)}else{subscribe(thenable,undefined,function(value){if(thenable!==value){resolve(promise,value,undefined)}else{fulfill(promise,value)}},function(reason){return reject(promise,reason)})}}function handleMaybeThenable(promise,maybeThenable,then$$){if(maybeThenable.constructor===promise.constructor&&then$$===then&&promise.constructor.resolve===resolve$1){handleOwnThenable(promise,maybeThenable)}else{if(then$$===GET_THEN_ERROR){reject(promise,GET_THEN_ERROR.error)}else if(then$$===undefined){fulfill(promise,maybeThenable)}else if(isFunction(then$$)){handleForeignThenable(promise,maybeThenable,then$$)}else{fulfill(promise,maybeThenable)}}}function resolve(promise,value){if(promise===value){fulfill(promise,value)}else if(objectOrFunction(value)){handleMaybeThenable(promise,value,getThen(value))}else{fulfill(promise,value)}}function publishRejection(promise){if(promise._onError){promise._onError(promise._result)}publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING){return}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length===0){if(config.instrument){instrument('fulfilled',promise)}}else{config.async(publish,promise)}}function reject(promise,reason){if(promise._state!==PENDING){return}promise._state=REJECTED;promise._result=reason;config.async(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;parent._onError=null;subscribers[length]=child;subscribers[length+FULFILLED]=onFulfillment;subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){config.async(publish,parent)}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(config.instrument){instrument(settled===FULFILLED?'fulfilled':'rejected',promise)}if(subscribers.length===0){return}var child=undefined,callback=undefined,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function ErrorObject(){this.error=null}var TRY_CATCH_ERROR=new ErrorObject();function tryCatch(callback,detail){try{return callback(detail)}catch(e){TRY_CATCH_ERROR.error=e;return TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=undefined,error=undefined,succeeded=undefined,failed=undefined;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){reject(promise,withOwnPromise());return}}else{value=detail;succeeded=true}if(promise._state!==PENDING){}else if(hasCallback&&succeeded){resolve(promise,value)}else if(failed){reject(promise,error)}else if(settled===FULFILLED){fulfill(promise,value)}else if(settled===REJECTED){reject(promise,value)}}function initializePromise(promise,resolver){var resolved=false;try{resolver(function(value){if(resolved){return}resolved=true;resolve(promise,value)},function(reason){if(resolved){return}resolved=true;reject(promise,reason)})}catch(e){reject(promise,e)}}function then(onFulfillment,onRejection,label){var _arguments=arguments;var parent=this;var state=parent._state;if(state===FULFILLED&&!onFulfillment||state===REJECTED&&!onRejection){config.instrument&&instrument('chained',parent,parent);return parent}parent._onError=null;var child=new parent.constructor(noop,label);var result=parent._result;config.instrument&&instrument('chained',parent,child);if(state){(function(){var callback=_arguments[state-1];config.async(function(){return invokeCallback(state,child,callback,result)})})()}else{subscribe(parent,child,onFulfillment,onRejection)}return child}function makeSettledResult(state,position,value){if(state===FULFILLED){return{state:'fulfilled',value:value}}else{return{state:'rejected',reason:value}}}function Enumerator(Constructor,input,abortOnReject,label){this._instanceConstructor=Constructor;this.promise=new Constructor(noop,label);this._abortOnReject=abortOnReject;if(this._validateInput(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._init();if(this.length===0){fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){fulfill(this.promise,this._result)}}}else{reject(this.promise,this._validationError())}}Enumerator.prototype._validateInput=function(input){return isArray(input)};Enumerator.prototype._validationError=function(){return new Error('Array Methods must be provided an Array')};Enumerator.prototype._init=function(){this._result=new Array(this.length)};Enumerator.prototype._enumerate=function(){var length=this.length;var promise=this.promise;var input=this._input;for(var i=0;promise._state===PENDING&&i<length;i++){this._eachEntry(input[i],i)}};Enumerator.prototype._settleMaybeThenable=function(entry,i){var c=this._instanceConstructor;var resolve=c.resolve;if(resolve===resolve$1){var then$$=getThen(entry);if(then$$===then&&entry._state!==PENDING){entry._onError=null;this._settledAt(entry._state,i,entry._result)}else if(typeof then$$!=='function'){this._remaining--;this._result[i]=this._makeResult(FULFILLED,i,entry)}else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,then$$);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve){return resolve(entry)}),i)}}else{this._willSettleAt(resolve(entry),i)}};Enumerator.prototype._eachEntry=function(entry,i){if(isMaybeThenable(entry)){this._settleMaybeThenable(entry,i)}else{this._remaining--;this._result[i]=this._makeResult(FULFILLED,i,entry)}};Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(this._abortOnReject&&state===REJECTED){reject(promise,value)}else{this._result[i]=this._makeResult(state,i,value)}}if(this._remaining===0){fulfill(promise,this._result)}};Enumerator.prototype._makeResult=function(state,i,value){return value};Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};function all(entries,label){return new Enumerator(this,entries,true,label).promise}function race(entries,label){var Constructor=this;var promise=new Constructor(noop,label);if(!isArray(entries)){reject(promise,new TypeError('You must pass an array to race.'));return promise}for(var i=0;promise._state===PENDING&&i<entries.length;i++){subscribe(Constructor.resolve(entries[i]),undefined,function(value){return resolve(promise,value)},function(reason){return reject(promise,reason)})}return promise}function reject$1(reason,label){var Constructor=this;var promise=new Constructor(noop,label);reject(promise,reason);return promise}var guidKey='rsvp_'+now()+'-';var counter=0;function needsResolver(){throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}function Promise(resolver,label){this._id=counter++;this._label=label;this._state=undefined;this._result=undefined;this._subscribers=[];config.instrument&&instrument('created',this);if(noop!==resolver){typeof resolver!=='function'&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.cast=resolve$1;Promise.all=all;Promise.race=race;Promise.resolve=resolve$1;Promise.reject=reject$1;Promise.prototype={constructor:Promise,_guidKey:guidKey,_onError:function _onError(reason){var promise=this;config.after(function(){if(promise._onError){config['trigger']('error',reason,promise._label)}})},then:then,'catch':function _catch(onRejection,label){return this.then(undefined,onRejection,label)},'finally':function _finally(callback,label){var promise=this;var constructor=promise.constructor;return promise.then(function(value){return constructor.resolve(callback()).then(function(){return value})},function(reason){return constructor.resolve(callback()).then(function(){throw reason;})},label)}};function Result(){this.value=undefined}var ERROR=new Result();var GET_THEN_ERROR$1=new Result();function getThen$1(obj){try{return obj.then}catch(error){ERROR.value=error;return ERROR}}function tryApply(f,s,a){try{f.apply(s,a)}catch(error){ERROR.value=error;return ERROR}}function makeObject(_,argumentNames){var obj={};var length=_.length;var args=new Array(length);for(var x=0;x<length;x++){args[x]=_[x]}for(var i=0;i<argumentNames.length;i++){var _name=argumentNames[i];obj[_name]=args[i+1]}return obj}function arrayResult(_){var length=_.length;var args=new Array(length-1);for(var i=1;i<length;i++){args[i-1]=_[i]}return args}function wrapThenable(_then,promise){return{then:function then(onFulFillment,onRejection){return _then.call(promise,onFulFillment,onRejection)}}}function denodeify(nodeFunc,options){var fn=function fn(){var self=this;var l=arguments.length;var args=new Array(l+1);var promiseInput=false;for(var i=0;i<l;++i){var arg=arguments[i];if(!promiseInput){promiseInput=needsPromiseInput(arg);if(promiseInput===GET_THEN_ERROR$1){var p=new Promise(noop);reject(p,GET_THEN_ERROR$1.value);return p}else if(promiseInput&&promiseInput!==true){arg=wrapThenable(promiseInput,arg)}}args[i]=arg}var promise=new Promise(noop);args[l]=function(err,val){if(err)reject(promise,err);else if(options===undefined)resolve(promise,val);else if(options===true)resolve(promise,arrayResult(arguments));else if(isArray(options))resolve(promise,makeObject(arguments,options));else resolve(promise,val)};if(promiseInput){return handlePromiseInput(promise,args,nodeFunc,self)}else{return handleValueInput(promise,args,nodeFunc,self)}};fn.__proto__=nodeFunc;return fn}function handleValueInput(promise,args,nodeFunc,self){var result=tryApply(nodeFunc,self,args);if(result===ERROR){reject(promise,result.value)}return promise}function handlePromiseInput(promise,args,nodeFunc,self){return Promise.all(args).then(function(args){var result=tryApply(nodeFunc,self,args);if(result===ERROR){reject(promise,result.value)}return promise})}function needsPromiseInput(arg){if(arg&&(typeof arg==="undefined"?"undefined":_typeof(arg))==='object'){if(arg.constructor===Promise){return true}else{return getThen$1(arg)}}else{return false}}function all$1(array,label){return Promise.all(array,label)}function AllSettled(Constructor,entries,label){this._superConstructor(Constructor,entries,false,label)}AllSettled.prototype=o_create(Enumerator.prototype);AllSettled.prototype._superConstructor=Enumerator;AllSettled.prototype._makeResult=makeSettledResult;AllSettled.prototype._validationError=function(){return new Error('allSettled must be called with an array')};function allSettled(entries,label){return new AllSettled(Promise,entries,label).promise}function race$1(array,label){return Promise.race(array,label)}function PromiseHash(Constructor,object,label){this._superConstructor(Constructor,object,true,label)}PromiseHash.prototype=o_create(Enumerator.prototype);PromiseHash.prototype._superConstructor=Enumerator;PromiseHash.prototype._init=function(){this._result={}};PromiseHash.prototype._validateInput=function(input){return input&&(typeof input==="undefined"?"undefined":_typeof(input))==='object'};PromiseHash.prototype._validationError=function(){return new Error('Promise.hash must be called with an object')};PromiseHash.prototype._enumerate=function(){var enumerator=this;var promise=enumerator.promise;var input=enumerator._input;var results=[];for(var key in input){if(promise._state===PENDING&&Object.prototype.hasOwnProperty.call(input,key)){results.push({position:key,entry:input[key]})}}var length=results.length;enumerator._remaining=length;var result=undefined;for(var i=0;promise._state===PENDING&&i<length;i++){result=results[i];enumerator._eachEntry(result.entry,result.position)}};function hash(object,label){return new PromiseHash(Promise,object,label).promise}function HashSettled(Constructor,object,label){this._superConstructor(Constructor,object,false,label)}HashSettled.prototype=o_create(PromiseHash.prototype);HashSettled.prototype._superConstructor=Enumerator;HashSettled.prototype._makeResult=makeSettledResult;HashSettled.prototype._validationError=function(){return new Error('hashSettled must be called with an object')};function hashSettled(object,label){return new HashSettled(Promise,object,label).promise}function rethrow(reason){setTimeout(function(){throw reason;});throw reason;}function defer(label){var deferred={resolve:undefined,reject:undefined};deferred.promise=new Promise(function(resolve,reject){deferred.resolve=resolve;deferred.reject=reject},label);return deferred}function map(promises,mapFn,label){return Promise.all(promises,label).then(function(values){if(!isFunction(mapFn)){throw new TypeError("You must pass a function as map's second argument.");}var length=values.length;var results=new Array(length);for(var i=0;i<length;i++){results[i]=mapFn(values[i])}return Promise.all(results,label)})}function resolve$2(value,label){return Promise.resolve(value,label)}function reject$2(reason,label){return Promise.reject(reason,label)}function resolveAll(promises,label){return Promise.all(promises,label)}function resolveSingle(promise,label){return Promise.resolve(promise,label).then(function(promises){return resolveAll(promises,label)})}function filter(promises,filterFn,label){var promise=isArray(promises)?resolveAll(promises,label):resolveSingle(promises,label);return promise.then(function(values){if(!isFunction(filterFn)){throw new TypeError("You must pass a function as filter's second argument.");}var length=values.length;var filtered=new Array(length);for(var i=0;i<length;i++){filtered[i]=filterFn(values[i])}return resolveAll(filtered,label).then(function(filtered){var results=new Array(length);var newLength=0;for(var i=0;i<length;i++){if(filtered[i]){results[newLength]=values[i];newLength++}}results.length=newLength;return results})})}var len=0;var vertxNext=undefined;function asap(callback,arg){queue$1[len]=callback;queue$1[len+1]=arg;len+=2;if(len===2){scheduleFlush$1()}}var browserWindow=typeof window!=='undefined'?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==='undefined'&&typeof process!=='undefined'&&{}.toString.call(process)==='[object process]';var isWorker=typeof Uint8ClampedArray!=='undefined'&&typeof importScripts!=='undefined'&&typeof MessageChannel!=='undefined';function useNextTick(){var nextTick=process.nextTick;var version=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);if(Array.isArray(version)&&version[1]==='0'&&version[2]==='10'){nextTick=setImmediate}return function(){return nextTick(flush)}}function useVertxTimer(){if(typeof vertxNext!=='undefined'){return function(){vertxNext(flush)}}return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode('');observer.observe(node,{characterData:true});return function(){return node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel();channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){return function(){return setTimeout(flush,1)}}var queue$1=new Array(1000);function flush(){for(var i=0;i<len;i+=2){var callback=queue$1[i];var arg=queue$1[i+1];callback(arg);queue$1[i]=undefined;queue$1[i+1]=undefined}len=0}function attemptVertex(){try{var r=require;var vertx=r('vertx');vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush$1=undefined;if(isNode){scheduleFlush$1=useNextTick()}else if(BrowserMutationObserver){scheduleFlush$1=useMutationObserver()}else if(isWorker){scheduleFlush$1=useMessageChannel()}else if(browserWindow===undefined&&typeof require==='function'){scheduleFlush$1=attemptVertex()}else{scheduleFlush$1=useSetTimeout()}var platform=undefined;if((typeof self==="undefined"?"undefined":_typeof(self))==='object'){platform=self}else if((typeof global==="undefined"?"undefined":_typeof(global))==='object'){platform=global}else{throw new Error('no global: `self` or `global` found');}var _async$filter;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}config.async=asap;config.after=function(cb){return setTimeout(cb,0)};var cast=resolve$2;var async=function async(callback,arg){return config.async(callback,arg)};function on(){config['on'].apply(config,arguments)}function off(){config['off'].apply(config,arguments)}if(typeof window!=='undefined'&&_typeof(window['__PROMISE_INSTRUMENTATION__'])==='object'){var callbacks=window['__PROMISE_INSTRUMENTATION__'];configure('instrument',true);for(var eventName in callbacks){if(callbacks.hasOwnProperty(eventName)){on(eventName,callbacks[eventName])}}}var rsvp=(_async$filter={cast:cast,Promise:Promise,EventTarget:EventTarget,all:all$1,allSettled:allSettled,race:race$1,hash:hash,hashSettled:hashSettled,rethrow:rethrow,defer:defer,denodeify:denodeify,configure:configure,on:on,off:off,resolve:resolve$2,reject:reject$2,map:map},_defineProperty(_async$filter,'async',async),_defineProperty(_async$filter,'filter',filter),_async$filter);exports['default']=rsvp;exports.cast=cast;exports.Promise=Promise;exports.EventTarget=EventTarget;exports.all=all$1;exports.allSettled=allSettled;exports.race=race$1;exports.hash=hash;exports.hashSettled=hashSettled;exports.rethrow=rethrow;exports.defer=defer;exports.denodeify=denodeify;exports.configure=configure;exports.on=on;exports.off=off;exports.resolve=resolve$2;exports.reject=reject$2;exports.map=map;exports.async=async;exports.filter=filter;Object.defineProperty(exports,'__esModule',{value:true})})}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"_process":15}],17:[function(require,module,exports){var root;if(typeof window!=='undefined'){root=window}else if(typeof self!=='undefined'){root=self}else{console.warn("Using browser-only version of superagent in non-browser environment");root=this}var Emitter=require('emitter');var requestBase=require('./request-base');var isObject=require('./is-object');function noop(){};var request=module.exports=require('./request').bind(null,Request);request.getXHR=function(){if(root.XMLHttpRequest&&(!root.location||'file:'!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest()}else{try{return new ActiveXObject('Microsoft.XMLHTTP')}catch(e){}try{return new ActiveXObject('Msxml2.XMLHTTP.6.0')}catch(e){}try{return new ActiveXObject('Msxml2.XMLHTTP.3.0')}catch(e){}try{return new ActiveXObject('Msxml2.XMLHTTP')}catch(e){}}throw Error("Browser-only verison of superagent could not find XHR");};var trim=''.trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,'')};function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){pushEncodedKeyValuePair(pairs,key,obj[key])}return pairs.join('&')}function pushEncodedKeyValuePair(pairs,key,val){if(val!=null){if(Array.isArray(val)){val.forEach(function(v){pushEncodedKeyValuePair(pairs,key,v)})}else if(isObject(val)){for(var subkey in val){pushEncodedKeyValuePair(pairs,key+'['+subkey+']',val[subkey])}}else{pairs.push(encodeURIComponent(key)+'='+encodeURIComponent(val))}}else if(val===null){pairs.push(encodeURIComponent(key))}}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split('&');var pair;var pos;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];pos=pair.indexOf('=');if(pos==-1){obj[decodeURIComponent(pair)]=''}else{obj[decodeURIComponent(pair.slice(0,pos))]=decodeURIComponent(pair.slice(pos+1))}}return obj}request.parseString=parseString;request.types={html:'text/html',json:'application/json',xml:'application/xml',urlencoded:'application/x-www-form-urlencoded','form':'application/x-www-form-urlencoded','form-data':'application/x-www-form-urlencoded'};request.serialize={'application/x-www-form-urlencoded':serialize,'application/json':JSON.stringify};request.parse={'application/x-www-form-urlencoded':parseString,'application/json':JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(':');field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function isJSON(mime){return(/[\/+]json\b/.test(mime))}function type(str){return str.split(/ *; */).shift()};function params(str){return str.split(/ *; */).reduce(function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})};function Response(req,options){options=options||{};this.req=req;this.xhr=this.req.xhr;this.text=this.req.method!='HEAD'&&(this.xhr.responseType===''||this.xhr.responseType==='text')||typeof this.xhr.responseType==='undefined'?this.xhr.responseText:null;this.statusText=this.req.xhr.statusText;this._setStatusProperties(this.xhr.status);this.header=this.headers=parseHeader(this.xhr.getAllResponseHeaders());this.header['content-type']=this.xhr.getResponseHeader('content-type');this._setHeaderProperties(this.header);this.body=this.req.method!='HEAD'?this._parseBody(this.text?this.text:this.xhr.response):null}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype._setHeaderProperties=function(header){var ct=this.header['content-type']||'';this.type=type(ct);var obj=params(ct);for(var key in obj){this[key]=obj[key]}};Response.prototype._parseBody=function(str){var parse=request.parse[this.type];if(!parse&&isJSON(this.type)){parse=request.parse['application/json']}return parse&&str&&(str.length||str instanceof Object)?parse(str):null};Response.prototype._setStatusProperties=function(status){if(status===1223){status=204}var type=status/100|0;this.status=this.statusCode=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var req=this.req;var method=req.method;var url=req.url;var msg='cannot '+method+' '+url+' ('+this.status+')';var err=new Error(msg);err.status=this.status;err.method=method;err.url=url;return err};request.Response=Response;function Request(method,url){var self=this;this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.on('end',function(){var err=null;var res=null;try{res=new Response(self)}catch(e){err=new Error('Parser is unable to parse the response');err.parse=true;err.original=e;err.rawResponse=self.xhr&&self.xhr.responseText?self.xhr.responseText:null;err.statusCode=self.xhr&&self.xhr.status?self.xhr.status:null;return self.callback(err)}self.emit('response',res);var new_err;try{if(res.status<200||res.status>=300){new_err=new Error(res.statusText||'Unsuccessful HTTP response');new_err.original=err;new_err.response=res;new_err.status=res.status}}catch(e){new_err=e}if(new_err){self.callback(new_err,res)}else{self.callback(null,res)}})}Emitter(Request.prototype);for(var key in requestBase){Request.prototype[key]=requestBase[key]}Request.prototype.type=function(type){this.set('Content-Type',request.types[type]||type);return this};Request.prototype.responseType=function(val){this._responseType=val;return this};Request.prototype.accept=function(type){this.set('Accept',request.types[type]||type);return this};Request.prototype.auth=function(user,pass,options){if(!options){options={type:'basic'}}switch(options.type){case'basic':var str=btoa(user+':'+pass);this.set('Authorization','Basic '+str);break;case'auto':this.username=user;this.password=pass;break}return this};Request.prototype.query=function(val){if('string'!=typeof val)val=serialize(val);if(val)this._query.push(val);return this};Request.prototype.attach=function(field,file,filename){this._getFormData().append(field,file,filename||file.name);return this};Request.prototype._getFormData=function(){if(!this._formData){this._formData=new root.FormData()}return this._formData};Request.prototype.callback=function(err,res){var fn=this._callback;this.clearTimeout();fn(err,res)};Request.prototype.crossDomainError=function(){var err=new Error('Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.');err.crossDomain=true;err.status=this.status;err.method=this.method;err.url=this.url;this.callback(err)};Request.prototype._timeoutError=function(){var timeout=this._timeout;var err=new Error('timeout of '+timeout+'ms exceeded');err.timeout=timeout;this.callback(err)};Request.prototype._appendQueryString=function(){var query=this._query.join('&');if(query){this.url+=~this.url.indexOf('?')?'&'+query:'?'+query}};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=request.getXHR();var timeout=this._timeout;var data=this._formData||this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;var status;try{status=xhr.status}catch(e){status=0}if(0==status){if(self.timedout)return self._timeoutError();if(self._aborted)return;return self.crossDomainError()}self.emit('end')};var handleProgress=function handleProgress(direction,e){if(e.total>0){e.percent=e.loaded/e.total*100}e.direction=direction;self.emit('progress',e)};if(this.hasListeners('progress')){try{xhr.onprogress=handleProgress.bind(null,'download');if(xhr.upload){xhr.upload.onprogress=handleProgress.bind(null,'upload')}}catch(e){}}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.timedout=true;self.abort()},timeout)}this._appendQueryString();if(this.username&&this.password){xhr.open(this.method,this.url,true,this.username,this.password)}else{xhr.open(this.method,this.url,true)}if(this._withCredentials)xhr.withCredentials=true;if('GET'!=this.method&&'HEAD'!=this.method&&'string'!=typeof data&&!this._isHost(data)){var contentType=this._header['content-type'];var serialize=this._serializer||request.serialize[contentType?contentType.split(';')[0]:''];if(!serialize&&isJSON(contentType))serialize=request.serialize['application/json'];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}if(this._responseType){xhr.responseType=this._responseType}this.emit('request',this);xhr.send(typeof data!=='undefined'?data:null);return this};request.Request=Request;request.get=function(url,data,fn){var req=request('GET',url);if('function'==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request('HEAD',url);if('function'==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.options=function(url,data,fn){var req=request('OPTIONS',url);if('function'==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};function del(url,fn){var req=request('DELETE',url);if(fn)req.end(fn);return req};request['del']=del;request['delete']=del;request.patch=function(url,data,fn){var req=request('PATCH',url);if('function'==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request('POST',url);if('function'==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request('PUT',url);if('function'==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req}},{"./is-object":18,"./request":20,"./request-base":19,"emitter":3}],18:[function(require,module,exports){function isObject(obj){return null!==obj&&'object'===(typeof obj==="undefined"?"undefined":_typeof(obj))}module.exports=isObject},{}],19:[function(require,module,exports){var isObject=require('./is-object');exports.clearTimeout=function _clearTimeout(){this._timeout=0;clearTimeout(this._timer);return this};exports.parse=function parse(fn){this._parser=fn;return this};exports.serialize=function serialize(fn){this._serializer=fn;return this};exports.timeout=function timeout(ms){this._timeout=ms;return this};exports.then=function then(resolve,reject){if(!this._fullfilledPromise){var self=this;this._fullfilledPromise=new Promise(function(innerResolve,innerReject){self.end(function(err,res){if(err)innerReject(err);else innerResolve(res)})})}return this._fullfilledPromise.then(resolve,reject)};exports.catch=function(cb){return this.then(undefined,cb)};exports.use=function use(fn){fn(this);return this};exports.get=function(field){return this._header[field.toLowerCase()]};exports.getHeader=exports.get;exports.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};exports.unset=function(field){delete this._header[field.toLowerCase()];delete this.header[field];return this};exports.field=function(name,val){if(null===name||undefined===name){throw new Error('.field(name, val) name can not be empty');}if(isObject(name)){for(var key in name){this.field(key,name[key])}return this}if(null===val||undefined===val){throw new Error('.field(name, val) val can not be empty');}this._getFormData().append(name,val);return this};exports.abort=function(){if(this._aborted){return this}this._aborted=true;this.xhr&&this.xhr.abort();this.req&&this.req.abort();this.clearTimeout();this.emit('abort');return this};exports.withCredentials=function(){this._withCredentials=true;return this};exports.redirects=function(n){this._maxRedirects=n;return this};exports.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}};exports._isHost=function _isHost(obj){var str={}.toString.call(obj);switch(str){case'[object File]':case'[object Blob]':case'[object FormData]':return true;default:return false}};exports.send=function(data){var obj=isObject(data);var type=this._header['content-type'];if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if('string'==typeof data){if(!type)this.type('form');type=this._header['content-type'];if('application/x-www-form-urlencoded'==type){this._data=this._data?this._data+'&'+data:data}else{this._data=(this._data||'')+data}}else{this._data=data}if(!obj||this._isHost(data))return this;if(!type)this.type('json');return this}},{"./is-object":18}],20:[function(require,module,exports){function request(RequestConstructor,method,url){if('function'==typeof url){return new RequestConstructor('GET',method).end(url)}if(2==arguments.length){return new RequestConstructor('GET',method)}return new RequestConstructor(method,url)}module.exports=request},{}],21:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function Ctor(){};var _=function _(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION='1.8.3';var optimizeCb=function optimizeCb(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function cb(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function createAssigner(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function baseCreate(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor();Ctor.prototype=null;return result};var property=function property(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property('length');var isArrayLike=function isArrayLike(collection){var length=getLength(collection);return typeof length=='number'&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!='number'||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),'value')};var group=function group(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function flatten(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=='number'){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function executeBound(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError('Bind must be called on a function');var args=slice.call(arguments,2);var bound=function bound(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function bound(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length){args.push(arguments[position++])}return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error('bindAll must be passed function names');for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function memoize(key){var cache=memoize.cache;var address=''+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function later(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function later(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--){result=args[i].call(this,result)}return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable('toString');var nonEnumerableProps=['valueOf','isPrototypeOf','toString','propertyIsEnumerable','hasOwnProperty','toLocaleString'];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop='constructor';if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj){if(_.has(obj,key))keys.push(key)}if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj){keys.push(key)}if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function iteratee(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function iteratee(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function eq(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case'[object RegExp]':case'[object String]':return''+a===''+b;case'[object Number]':if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case'[object Date]':case'[object Boolean]':return+a===+b}var areArrays=className==='[object Array]';if(!areArrays){if((typeof a==="undefined"?"undefined":_typeof(a))!='object'||(typeof b==="undefined"?"undefined":_typeof(b))!='object')return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&'constructor'in a&&'constructor'in b){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==='[object Array]'};_.isObject=function(obj){var type=typeof obj==="undefined"?"undefined":_typeof(obj);return type==='function'||type==='object'&&!!obj};_.each(['Arguments','Function','String','Number','Date','RegExp','Error'],function(name){_['is'+name]=function(obj){return toString.call(obj)==='[object '+name+']'}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,'callee')}}if(typeof/./!='function'&&(typeof Int8Array==="undefined"?"undefined":_typeof(Int8Array))!='object'){_.isFunction=function(obj){return typeof obj=='function'||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==='[object Boolean]'};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++){accum[i]=iteratee(i)}return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return new Date().getTime()};var escapeMap={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','`':'&#x60;'};var unescapeMap=_.invert(escapeMap);var createEscaper=function createEscaper(map){var escaper=function escaper(match){return map[match]};var source='(?:'+_.keys(map).join('|')+')';var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,'g');return function(string){string=string==null?'':''+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n',"\u2028":'u2028',"\u2029":'u2029'};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function escapeChar(match){return'\\'+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+'return __p;\n';try{var render=new Function(settings.variable||'obj','_',source)}catch(e){e.source=source;throw e;}var template=function template(data){return render.call(this,data,_)};var argument=settings.variable||'obj';template.source='function('+argument+'){\n'+source+'}';return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function result(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==='shift'||name==='splice')&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return''+this._wrapped};if(typeof define==='function'&&define.amd){define('underscore',[],function(){return _})}}).call(this)},{}],22:[function(require,module,exports){var polyfill=require('./index.js').polyfill;window=window||{};polyfill();polyfill(window);try{localStorage=localStorage||require('./localstorage.js')}catch(e){}try{XMLHttpRequest=XMLHttpRequest||require('./xmlhttprequest.js')}catch(e){}try{FormData=FormData||require('./formdata.js')}catch(e){}try{WebSocket=WebSocket||require('./websocket.js')}catch(e){}},{"./formdata.js":23,"./index.js":24,"./localstorage.js":25,"./websocket.js":26,"./xmlhttprequest.js":27}],23:[function(require,module,exports){var FormData=function(){function FormData(){_classCallCheck(this,FormData);this._entries=[]}_createClass(FormData,[{key:"append",value:function append(name,value){if(typeof name!=='string'){throw new TypeError('FormData name must be a string');}if(typeof value!=='string'){if((typeof value==="undefined"?"undefined":_typeof(value))!=='object'||typeof value.uri!=='string'){throw new TypeError('FormData value must be a string or { uri: tempFilePath }');}}this._entries.push([name,value]);}},{key:"set",value:function set(name,value){var entry=this.get(name);if(entry){entry[1]=value;}else{this.append(name,value);}}},{key:"delete",value:function _delete(name){this._entries=this._entries.filter(function(entry){return entry[0]!==name;});}},{key:"entries",value:function entries(){return this._entries;}},{key:"get",value:function get(name){return this._entries.find(function(entry){return entry[0]===name;});}},{key:"getAll",value:function getAll(name){return this._entries.filter(function(entry){return entry[0]===name;});}},{key:"has",value:function has(name){return this._entries.some(function(entry){return entry[0]===name;});}},{key:"keys",value:function keys(){return this._entries.map(function(entry){return entry[0];});}},{key:"values",value:function values(){return this._entries.map(function(entry){return entry[1];});}}]);return FormData;}();module.exports=FormData;},{}],24:[function(require,module,exports){(function(global){var localStorage=require('./localstorage.js');var XMLHttpRequest=require('./xmlhttprequest.js');var FormData=require('./formdata.js');var WebSocket=require('./websocket.js');module.exports={polyfill:function polyfill(){var target=arguments.length>0&&arguments[0]!==undefined?arguments[0]:global||window;if((typeof target==="undefined"?"undefined":_typeof(target))!=='object'){throw new Error('polyfill target is not an Object');}Object.assign(target,{localStorage:localStorage,XMLHttpRequest:XMLHttpRequest,FormData:FormData,WebSocket:WebSocket,Object:Object});if(target.localStorage!==localStorage){target.wxStorage=localStorage;}},localStorage:localStorage,XMLHttpRequest:XMLHttpRequest,FormData:FormData,WebSocket:WebSocket};}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});},{"./formdata.js":23,"./localstorage.js":25,"./websocket.js":26,"./xmlhttprequest.js":27}],25:[function(require,module,exports){var Storage=function(){function Storage(){_classCallCheck(this,Storage);}_createClass(Storage,[{key:"getItem",value:function getItem(key){return wx.getStorageSync(key);}},{key:"setItem",value:function setItem(key,value){return wx.setStorageSync(key,value);}},{key:"removeItem",value:function removeItem(key){return this.setItem(key,'');}},{key:"clear",value:function clear(){return wx.clearStorageSync();}}]);return Storage;}();module.exports=new Storage();},{}],26:[function(require,module,exports){var EventTarget=require('event-target-shim');var CONNECTING=0;var OPEN=1;var CLOSING=2;var CLOSED=3;var EVENTS=['open','error','message','close'];var instance=void 0;wx.onSocketOpen(function(event){if(instance){instance._readyState=OPEN;instance.dispatchEvent({type:'open'});}});wx.onSocketError(function(event){if(instance){instance._readyState=CLOSED;instance.dispatchEvent(event);}});wx.onSocketMessage(function(event){if(instance){var data=event.data,origin=event.origin,ports=event.ports,source=event.source;instance.dispatchEvent({data:data,origin:origin,ports:ports,source:source,type:'message'});}});wx.onSocketClose(function(event){if(instance){instance._readyState=CLOSED;var code=event.code,reason=event.reason,wasClean=event.wasClean;instance.dispatchEvent({code:code,reason:reason,wasClean:wasClean,type:'close'});instance=null;}});var WebSocket=function(_EventTarget){_inherits(WebSocket,_EventTarget);function WebSocket(url,protocal){_classCallCheck(this,WebSocket);if(!url){throw new TypeError('Failed to construct \'WebSocket\': url required')}if(protocal){throw new Error('subprotocal not supported in weapp');}var _this=_possibleConstructorReturn(this,(WebSocket.__proto__||Object.getPrototypeOf(WebSocket)).call(this));_this._url=url;_this._protocal='';_this._readyState=CONNECTING;if(instance){instance.dispatchEvent({type:'close'})}instance=_this;wx.connectSocket({url:url});return _this}_createClass(WebSocket,[{key:"close",value:function close(){if(this.readyState===CONNECTING){console.warn('close WebSocket which is connecting might not work')}wx.closeSocket()}},{key:"send",value:function send(data){if(this.readyState!==OPEN){throw new Error('INVALID_STATE_ERR');}if(typeof data!=='string'){throw new TypeError('only string typed data are supported');}wx.sendSocketMessage({data:data})}},{key:"url",get:function get(){return this._url}},{key:"protocal",get:function get(){return this._protocal}},{key:"readyState",get:function get(){return this._readyState}}]);return WebSocket}(EventTarget(EVENTS));Object.assign(WebSocket,{CONNECTING:CONNECTING,OPEN:OPEN,CLOSING:CLOSING,CLOSED:CLOSED});module.exports=WebSocket},{"event-target-shim":9}],27:[function(require,module,exports){var EventTarget=require('event-target-shim');var FormData=require('./formdata.js');var UNSENT=0;var OPENED=1;var HEADERS_RECEIVED=2;var LOADING=3;var DONE=4;var REQUEST_EVENTS=['abort','error','load','loadstart','progress','timeout','loadend','readystatechange'];function successCallback(response){this.status=response.statusCode;this.statusText=response.statusCode;var text=response.data;if(typeof text!=='string'){text=JSON.stringify(text)}this.responseText=this.response=text;this.readyState=DONE;this.dispatchEvent({type:'readystatechange'})}var XMLHttpRequest=function(_EventTarget2){_inherits(XMLHttpRequest,_EventTarget2);function XMLHttpRequest(){_classCallCheck(this,XMLHttpRequest);var _this2=_possibleConstructorReturn(this,(XMLHttpRequest.__proto__||Object.getPrototypeOf(XMLHttpRequest)).call(this));_this2.readyState=UNSENT;_this2._headers={};return _this2}_createClass(XMLHttpRequest,[{key:"abort",value:function abort(){throw new Error('not supported in weapp');}},{key:"getAllResponseHeaders",value:function getAllResponseHeaders(){console.warn('getAllResponseHeaders always returns \'\'');return''}},{key:"getResponseHeader",value:function getResponseHeader(key){if(key==='content-type'){console.warn('get content-type always returns \'application/json\'');return'application/json'}console.warn('getResponseHeader always returns \'\'');return''}},{key:"overrideMimeType",value:function overrideMimeType(){throw new Error('not supported in weapp');}},{key:"open",value:function open(method,url){var async=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(this.readyState!==UNSENT){throw new Error('request is already opened');}if(!async){throw new Error('sync request is not supported');}this._method=method;this._url=url;this.readyState=OPENED;this.dispatchEvent({type:'readystatechange'})}},{key:"setRequestHeader",value:function setRequestHeader(header,value){if(this.readyState!==OPENED){throw new Error('request is not opened');}this._headers[header.toLowerCase()]=value}},{key:"send",value:function send(data){var _this3=this;if(this.readyState!==OPENED){throw new Error('request is not opened');}if(data instanceof FormData){var entries=data.entries();var blobs=entries.filter(function(entry){return typeof entry[1]!=='string'});if(blobs.length===0){throw new Error('Must specify a Blob field in FormData');}if(blobs.length>1){console.warn('Only the first Blob will be send in Weapp')}var restData=entries.filter(function(entry){return typeof entry[1]==='string'}).reduce(function(result,entry){return Object.assign(result,_defineProperty2({},entry[0],entry[1]))},{});wx.uploadFile({url:this._url,name:blobs[0][0],filePath:blobs[0][1].uri,formData:restData,header:this._headers,success:successCallback.bind(this),fail:function fail(error){_this3.dispatchEvent({type:'error'})}})}else{wx.request({url:this._url,data:data||'',method:this._method,header:this._headers,success:successCallback.bind(this),fail:function fail(error){_this3.dispatchEvent({type:'error'})}})}}}]);return XMLHttpRequest}(EventTarget(REQUEST_EVENTS));Object.assign(XMLHttpRequest,{UNSENT:UNSENT,OPENED:OPENED,HEADERS_RECEIVED:HEADERS_RECEIVED,LOADING:LOADING,DONE:DONE});module.exports=XMLHttpRequest},{"./formdata.js":23,"event-target-shim":9}],28:[function(require,module,exports){var _=require('underscore');module.exports=function(AV){var PUBLIC_KEY="*";AV.ACL=function(arg1){var self=this;self.permissionsById={};if(_.isObject(arg1)){if(arg1 instanceof AV.User){self.setReadAccess(arg1,true);self.setWriteAccess(arg1,true)}else{if(_.isFunction(arg1)){throw"AV.ACL() called with a function.  Did you forget ()?";}AV._objectEach(arg1,function(accessList,userId){if(!_.isString(userId)){throw"Tried to create an ACL with an invalid userId.";}self.permissionsById[userId]={};AV._objectEach(accessList,function(allowed,permission){if(permission!=="read"&&permission!=="write"){throw"Tried to create an ACL with an invalid permission type.";}if(!_.isBoolean(allowed)){throw"Tried to create an ACL with an invalid permission value.";}self.permissionsById[userId][permission]=allowed})})}}};AV.ACL.prototype.toJSON=function(){return _.clone(this.permissionsById)};AV.ACL.prototype._setAccess=function(accessType,userId,allowed){if(userId instanceof AV.User){userId=userId.id}else if(userId instanceof AV.Role){userId="role:"+userId.getName()}if(!_.isString(userId)){throw"userId must be a string.";}if(!_.isBoolean(allowed)){throw"allowed must be either true or false.";}var permissions=this.permissionsById[userId];if(!permissions){if(!allowed){return}else{permissions={};this.permissionsById[userId]=permissions}}if(allowed){this.permissionsById[userId][accessType]=true}else{delete permissions[accessType];if(_.isEmpty(permissions)){delete permissions[userId]}}};AV.ACL.prototype._getAccess=function(accessType,userId){if(userId instanceof AV.User){userId=userId.id}else if(userId instanceof AV.Role){userId="role:"+userId.getName()}var permissions=this.permissionsById[userId];if(!permissions){return false}return permissions[accessType]?true:false};AV.ACL.prototype.setReadAccess=function(userId,allowed){this._setAccess("read",userId,allowed)};AV.ACL.prototype.getReadAccess=function(userId){return this._getAccess("read",userId)};AV.ACL.prototype.setWriteAccess=function(userId,allowed){this._setAccess("write",userId,allowed)};AV.ACL.prototype.getWriteAccess=function(userId){return this._getAccess("write",userId)};AV.ACL.prototype.setPublicReadAccess=function(allowed){this.setReadAccess(PUBLIC_KEY,allowed)};AV.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess(PUBLIC_KEY)};AV.ACL.prototype.setPublicWriteAccess=function(allowed){this.setWriteAccess(PUBLIC_KEY,allowed)};AV.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess(PUBLIC_KEY)};AV.ACL.prototype.getRoleReadAccess=function(role){if(role instanceof AV.Role){role=role.getName()}if(_.isString(role)){return this.getReadAccess("role:"+role)}throw"role must be a AV.Role or a String";};AV.ACL.prototype.getRoleWriteAccess=function(role){if(role instanceof AV.Role){role=role.getName()}if(_.isString(role)){return this.getWriteAccess("role:"+role)}throw"role must be a AV.Role or a String";};AV.ACL.prototype.setRoleReadAccess=function(role,allowed){if(role instanceof AV.Role){role=role.getName()}if(_.isString(role)){this.setReadAccess("role:"+role,allowed);return}throw"role must be a AV.Role or a String";};AV.ACL.prototype.setRoleWriteAccess=function(role,allowed){if(role instanceof AV.Role){role=role.getName()}if(_.isString(role)){this.setWriteAccess("role:"+role,allowed);return}throw"role must be a AV.Role or a String";}}},{"underscore":21}],29:[function(require,module,exports){(function(process,global){var _=require('underscore');var _require=require('./utils'),isNullOrUndefined=_require.isNullOrUndefined;var AV=global.AV||{};AV._config=AV._config||{};var AVConfig=AV._config;_.extend(AVConfig,{region:'cn',APIServerURL:AVConfig.APIServerURL||'',isNode:false,disableCurrentUser:false,userAgent:null,applicationProduction:null});if(typeof process!=='undefined'&&process.versions&&process.versions.node){AVConfig.isNode=true}var EmptyConstructor=function EmptyConstructor(){};var inherits=function inherits(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty('constructor')){child=protoProps.constructor}else{child=function child(){parent.apply(this,arguments)}}_.extend(child,parent);EmptyConstructor.prototype=parent.prototype;child.prototype=new EmptyConstructor();if(protoProps){_.extend(child.prototype,protoProps)}if(staticProps){_.extend(child,staticProps)}child.prototype.constructor=child;child.__super__=parent.prototype;return child};AV.setProduction=function(production){if(!isNullOrUndefined(production)){AVConfig.applicationProduction=production?1:0}else{AVConfig.applicationProduction=null}};AV._getAVPath=function(path){if(!AV.applicationId){throw"You need to call AV.initialize before using AV.";}if(!path){path=""}if(!_.isString(path)){throw"Tried to get a localStorage path that wasn't a String.";}if(path[0]==="/"){path=path.substring(1)}return"AV/"+AV.applicationId+"/"+path};AV._installationId=null;AV._getInstallationId=function(){if(AV._installationId){return AV.Promise.resolve(AV._installationId)}var path=AV._getAVPath("installationId");return AV.localStorage.getItemAsync(path).then(function(_installationId){AV._installationId=_installationId;if(!AV._installationId){var hexOctet=function hexOctet(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1)};AV._installationId=hexOctet()+hexOctet()+"-"+hexOctet()+"-"+hexOctet()+"-"+hexOctet()+"-"+hexOctet()+hexOctet()+hexOctet();return AV.localStorage.setItemAsync(path,AV._installationId)}else{return _installationId}})};AV._parseDate=function(iso8601){var regexp=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$");var match=regexp.exec(iso8601);if(!match){return null}var year=match[1]||0;var month=(match[2]||1)-1;var day=match[3]||0;var hour=match[4]||0;var minute=match[5]||0;var second=match[6]||0;var milli=match[8]||0;return new Date(Date.UTC(year,month,day,hour,minute,second,milli))};AV._extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child};AV._getValue=function(object,prop){if(!(object&&object[prop])){return null}return _.isFunction(object[prop])?object[prop]():object[prop]};AV._encode=function(value,seenObjects,disallowObjects){if(value instanceof AV.Object){if(disallowObjects){throw"AV.Objects not allowed here";}if(!seenObjects||_.include(seenObjects,value)||!value._hasData){return value._toPointer()}if(!value.dirty()){seenObjects=seenObjects.concat(value);return AV._encode(value._toFullJSON(seenObjects),seenObjects,disallowObjects)}throw"Tried to save an object with a pointer to a new, unsaved object.";}if(value instanceof AV.ACL){return value.toJSON()}if(_.isDate(value)){return{"__type":"Date","iso":value.toJSON()}}if(value instanceof AV.GeoPoint){return value.toJSON()}if(_.isArray(value)){return _.map(value,function(x){return AV._encode(x,seenObjects,disallowObjects)})}if(_.isRegExp(value)){return value.source}if(value instanceof AV.Relation){return value.toJSON()}if(value instanceof AV.Op){return value.toJSON()}if(value instanceof AV.File){if(!value.url()&&!value.id){throw"Tried to save an object containing an unsaved file.";}return{__type:"File",id:value.id,name:value.name(),url:value.url()}}if(_.isObject(value)){var output={};AV._objectEach(value,function(v,k){output[k]=AV._encode(v,seenObjects,disallowObjects)});return output}return value};AV._decode=function(key,value){if(!_.isObject(value)){return value}if(_.isArray(value)){AV._arrayEach(value,function(v,k){value[k]=AV._decode(k,v)});return value}if(value instanceof AV.Object){return value}if(value instanceof AV.File){return value}if(value instanceof AV.Op){return value}if(value.__op){return AV.Op._decode(value)}var className;if(value.__type==="Pointer"){className=value.className;var pointer=AV.Object._create(className);if(Object.keys(value).length>3){delete value.__type;delete value.className;pointer._finishFetch(value,true)}else{pointer._finishFetch({objectId:value.objectId},false)}return pointer}if(value.__type==="Object"){className=value.className;delete value.__type;delete value.className;var object=AV.Object._create(className);object._finishFetch(value,true);return object}if(value.__type==="Date"){return AV._parseDate(value.iso)}if(value.__type==="GeoPoint"){return new AV.GeoPoint({latitude:value.latitude,longitude:value.longitude})}if(key==="ACL"){if(value instanceof AV.ACL){return value}return new AV.ACL(value)}if(value.__type==="Relation"){var relation=new AV.Relation(null,key);relation.targetClassName=value.className;return relation}if(value.__type==='File'){var file=new AV.File(value.name);file.attributes.metaData=value.metaData||{};file.attributes.url=value.url;file.id=value.objectId;return file}AV._objectEach(value,function(v,k){value[k]=AV._decode(k,v)});return value};AV._encodeObjectOrArray=function(value){var encodeAVObject=function encodeAVObject(object){if(object&&object._toFullJSON){object=object._toFullJSON([])}return _.mapObject(object,function(value){return AV._encode(value,[])})};if(_.isArray(value)){return value.map(function(object){return encodeAVObject(object)})}else{return encodeAVObject(value)}};AV._arrayEach=_.each;AV._traverse=function(object,func,seen){if(object instanceof AV.Object){seen=seen||[];if(_.indexOf(seen,object)>=0){return}seen.push(object);AV._traverse(object.attributes,func,seen);return func(object)}if(object instanceof AV.Relation||object instanceof AV.File){return func(object)}if(_.isArray(object)){_.each(object,function(child,index){var newChild=AV._traverse(child,func,seen);if(newChild){object[index]=newChild}});return func(object)}if(_.isObject(object)){AV._each(object,function(child,key){var newChild=AV._traverse(child,func,seen);if(newChild){object[key]=newChild}});return func(object)}return func(object)};AV._objectEach=AV._each=function(obj,callback){if(_.isObject(obj)){_.each(_.keys(obj),function(key){callback(obj[key],key)})}else{_.each(obj,callback)}};module.exports=AV}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./utils":57,"_process":15,"underscore":21}],30:[function(require,module,exports){(function(global){var _=require('underscore');var Promise=require('../promise');var Storage={};var apiNames=['getItem','setItem','removeItem','clear'];if(global.localStorage){var localStorage=global.localStorage;try{var testKey='__storejs__';localStorage.setItem(testKey,testKey);if(localStorage.getItem(testKey)!=testKey){throw new Error();}localStorage.removeItem(testKey)}catch(e){localStorage=require('localstorage-memory')}_(apiNames).each(function(apiName){Storage[apiName]=function(){return global.localStorage[apiName].apply(global.localStorage,arguments)}});Storage.async=false}else{var AsyncStorage=require('react-native').AsyncStorage;_(apiNames).each(function(apiName){Storage[apiName+'Async']=function(){return Promise.resolve(AsyncStorage[apiName].apply(AsyncStorage,arguments))}});Storage.async=true}module.exports=Storage}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../promise":45,"localstorage-memory":12,"react-native":1,"underscore":21}],31:[function(require,module,exports){var dataURItoBlob=function dataURItoBlob(dataURI,type){var byteString;if(dataURI.indexOf('base64')<0){byteString=atob(dataURI)}else if(dataURI.split(',')[0].indexOf('base64')>=0){byteString=atob(dataURI.split(',')[1])}else{byteString=unescape(dataURI.split(',')[1])}var mimeString=type||dataURI.split(',')[0].split(':')[1].split(';')[0];var ia=new Uint8Array(byteString.length);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}return new Blob([ia],{type:mimeString})};module.exports=dataURItoBlob},{}],32:[function(require,module,exports){var storage=require('./localstorage');var AV=require('./av');var removeAsync=exports.removeAsync=storage.removeItemAsync.bind(storage);var getCacheData=function getCacheData(cacheData,key){try{cacheData=JSON.parse(cacheData)}catch(e){return null}if(cacheData){var expired=cacheData.expiredAt&&cacheData.expiredAt<Date.now();if(!expired){return cacheData.value}return removeAsync(key).then(function(){return null})}return null};exports.getAsync=function(key){key=AV.applicationId+"/"+key;return storage.getItemAsync(key).then(function(cache){return getCacheData(cache,key)})};exports.setAsync=function(key,value,ttl){var cache={value:value};if(typeof ttl==='number'){cache.expiredAt=Date.now()+ttl}return storage.setItemAsync(AV.applicationId+"/"+key,JSON.stringify(cache))}},{"./av":29,"./localstorage":42}],33:[function(require,module,exports){var _=require('underscore');var AVRequest=require('./request').request;module.exports=function(AV){AV.Cloud=AV.Cloud||{};_.extend(AV.Cloud,{run:function run(name,data,options){var request=AVRequest('functions',name,null,'POST',AV._encode(data,null,true),options);return request.then(function(resp){return AV._decode(null,resp).result})},rpc:function rpc(name,data,options){if(_.isArray(data)){return Promise.reject(new Error('Can\'t pass Array as the param of rpc function in JavaScript SDK.'))}return AVRequest('call',name,null,'POST',AV._encodeObjectOrArray(data),options).then(function(resp){return AV._decode('',resp).result})},getServerDate:function getServerDate(){var request=AVRequest("date",null,null,'GET');return request.then(function(resp){return AV._decode(null,resp)})},requestSmsCode:function requestSmsCode(data){if(_.isString(data)){data={mobilePhoneNumber:data}}if(!data.mobilePhoneNumber){throw"Missing mobilePhoneNumber.";}var request=AVRequest("requestSmsCode",null,null,'POST',data);return request},verifySmsCode:function verifySmsCode(code,phone){if(!code)throw"Missing sms code.";var params={};if(_.isString(phone)){params['mobilePhoneNumber']=phone}var request=AVRequest("verifySmsCode",code,null,'POST',params);return request}})}},{"./request":49,"underscore":21}],34:[function(require,module,exports){var _=require('underscore');function AVError(code,message){var error=new Error(message);error.code=code;return error}_.extend(AVError,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,MISSING_CONTENT_TYPE:126,MISSING_CONTENT_LENGTH:127,INVALID_CONTENT_LENGTH:128,FILE_TOO_LARGE:129,FILE_SAVE_ERROR:130,FILE_DELETE_ERROR:153,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,SCRIPT_FAILED:141,VALIDATION_ERROR:142,INVALID_IMAGE_DATA:150,UNSAVED_FILE_ERROR:151,INVALID_PUSH_TIME_ERROR:152,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252,X_DOMAIN_REQUEST:602});module.exports=AVError},{"underscore":21}],35:[function(require,module,exports){var _=require('underscore');module.exports=function(AV){var eventSplitter=/\s+/;var slice=Array.prototype.slice;AV.Events={on:function on(events,callback,context){var calls,event,node,tail,list;if(!callback){return this}events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});event=events.shift();while(event){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node};event=events.shift()}return this},off:function off(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks)){return}if(!(events||callback||context)){delete this._callbacks;return this}events=events?events.split(eventSplitter):_.keys(calls);event=events.shift();while(event){node=calls[event];delete calls[event];if(!node||!(callback||context)){continue}tail=node.tail;node=node.next;while(node!==tail){cb=node.callback;ctx=node.context;if(callback&&cb!==callback||context&&ctx!==context){this.on(event,cb,ctx)}node=node.next}event=events.shift()}return this},trigger:function trigger(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks)){return this}all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);event=events.shift();while(event){node=calls[event];if(node){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest)}}node=all;if(node){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args)}}event=events.shift()}return this}};AV.Events.bind=AV.Events.on;AV.Events.unbind=AV.Events.off}},{"underscore":21}],36:[function(require,module,exports){(function(global){var _=require('underscore');var cos=require('./uploader/cos');var qiniu=require('./uploader/qiniu');var s3=require('./uploader/s3');var AVError=require('./error');var AVRequest=require('./request').request;var Promise=require('./promise');module.exports=function(AV){var avConfig=AV._config;var extname=function extname(path){return path.match(/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/)[4]};var b64Digit=function b64Digit(number){if(number<26){return String.fromCharCode(65+number)}if(number<52){return String.fromCharCode(97+(number-26))}if(number<62){return String.fromCharCode(48+(number-52))}if(number===62){return'+'}if(number===63){return'/'}throw new Error('Tried to encode large digit '+number+' in base64.');};var encodeBase64=function encodeBase64(array){var chunks=[];chunks.length=Math.ceil(array.length/3);_.times(chunks.length,function(i){var b1=array[i*3];var b2=array[i*3+1]||0;var b3=array[i*3+2]||0;var has2=i*3+1<array.length;var has3=i*3+2<array.length;chunks[i]=[b64Digit(b1>>2&0x3F),b64Digit(b1<<4&0x30|b2>>4&0x0F),has2?b64Digit(b2<<2&0x3C|b3>>6&0x03):"=",has3?b64Digit(b3&0x3F):"="].join("")});return chunks.join("")};var dataURLToBase64=function dataURLToBase64(base64){if(base64.split(',')[0]&&base64.split(',')[0].indexOf('base64')>=0){base64=base64.split(',')[1]}return base64};var isCnNode=function isCnNode(){return avConfig.region==='cn'};var mimeTypes={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"};AV.File=function(name,data,type){this.attributes={name:name,url:'',metaData:{},base64:''};var owner=void 0;if(data&&data.owner){owner=data.owner}else if(!AV._config.disableCurrentUser){try{owner=AV.User.current()}catch(error){if('SYNC_API_NOT_AVAILABLE'===error.code){console.warn('Get current user failed. It seems this runtime use an async storage system, please create AV.File in the callback of AV.User.currentAsync().')}else{throw error;}}}this.attributes.metaData={owner:owner?owner.id:'unknown'};var extension=/\.([^.]*)$/.exec(name);if(extension){extension=extension[1].toLowerCase()}var guessedType=type||mimeTypes[extension]||"text/plain";this._guessedType=guessedType;if(_.isArray(data)){this.attributes.metaData.size=data.length;data={base64:encodeBase64(data)}}if(data&&data.base64){var parseBase64=require('./browserify-wrapper/parse-base64');var dataBase64=parseBase64(data.base64,guessedType);this.attributes.base64=dataURLToBase64(data.base64);this._source=Promise.resolve({data:dataBase64,type:guessedType})}else if(data&&data.blob){if(!data.blob.type){data.blob.type=guessedType}this._source=Promise.resolve({data:data.blob,type:guessedType})}else if(typeof File!=="undefined"&&data instanceof global.File){if(data.size){this.attributes.metaData.size=data.size}this._source=Promise.resolve({data:data,type:guessedType})}else if(typeof global.Buffer!=="undefined"&&global.Buffer.isBuffer(data)){this.attributes.metaData.size=data.length;this._source=Promise.resolve({data:data,type:guessedType})}else if(_.isString(data)){throw new Error("Creating a AV.File from a String is not yet supported.");}};AV.File.withURL=function(name,url,metaData,type){if(!name||!url){throw"Please provide file name and url";}var file=new AV.File(name,null,type);if(metaData){for(var prop in metaData){if(!file.attributes.metaData[prop])file.attributes.metaData[prop]=metaData[prop]}}file.attributes.url=url;file.attributes.metaData.__source='external';return file};AV.File.createWithoutData=function(objectId){var file=new AV.File();file.id=objectId;return file};AV.File.prototype={className:'_File',toJSON:function toJSON(){return AV._encode(this)},getACL:function getACL(){return this._acl},setACL:function setACL(acl){if(!(acl instanceof AV.ACL)){return new AVError(AVError.OTHER_CAUSE,'ACL must be a AV.ACL.')}this._acl=acl},name:function name(){return this.get('name')},url:function url(){return this.get('url')},get:function get(attrName){switch(attrName){case'objectId':return this.id;case'url':case'name':case'metaData':case'createdAt':case'updatedAt':return this.attributes[attrName];default:return this.attributes.metaData[attrName]}},set:function set(){var _this4=this;var set=function set(attrName,value){switch(attrName){case'name':case'url':case'base64':case'metaData':_this4.attributes[attrName]=value;break;default:_this4.attributes.metaData[attrName]=value;break}};for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}switch(args.length){case 1:for(var k in args[0]){set(k,args[0][k])}break;case 2:set(args[0],args[1]);break}},metaData:function metaData(attr,value){if(attr&&value){this.attributes.metaData[attr]=value;return this}else if(attr&&!value){return this.attributes.metaData[attr]}else{return this.attributes.metaData}},thumbnailURL:function thumbnailURL(width,height,quality,scaleToFit,fmt){var url=this.attributes.url;if(!url){throw new Error('Invalid url.');}if(!width||!height||width<=0||height<=0){throw new Error('Invalid width or height value.');}quality=quality||100;scaleToFit=!scaleToFit?true:scaleToFit;if(quality<=0||quality>100){throw new Error('Invalid quality value.');}fmt=fmt||'png';var mode=scaleToFit?2:1;return url+'?imageView/'+mode+'/w/'+width+'/h/'+height+'/q/'+quality+'/format/'+fmt},size:function size(){return this.metaData().size},ownerId:function ownerId(){return this.metaData().owner},destroy:function destroy(options){if(!this.id){return Promise.reject(new Error('The file id is not eixsts.'))}var request=AVRequest("files",null,this.id,'DELETE',null,options);return request},_fileToken:function _fileToken(type){var route=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'fileTokens';var name=this.attributes.name;var extName=extname(name);var hexOctet=function hexOctet(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1)};var key=hexOctet()+hexOctet()+hexOctet()+hexOctet()+hexOctet()+extName;var data={key:key,name:name,ACL:this._acl,mime_type:type,metaData:this.attributes.metaData};if(type&&!this.attributes.metaData.mime_type){this.attributes.metaData.mime_type=type}this._qiniu_key=key;return AVRequest(route,null,null,'POST',data)},save:function save(options){var _this5=this;if(this.id){throw new Error('File already saved. If you want to manipulate a file, use AV.Query to get it.');}if(!this._previousSave){if(this._source){this._previousSave=this._source.then(function(_ref){var data=_ref.data,type=_ref.type;return _this5._fileToken(type).then(function(uploadInfo){var uploadPromise=void 0;switch(uploadInfo.provider){case's3':uploadPromise=s3(uploadInfo,data,_this5,options);break;case'qcloud':uploadPromise=cos(uploadInfo,data,_this5,options);break;case'qiniu':default:uploadPromise=qiniu(uploadInfo,data,_this5,options);break}return uploadPromise.catch(function(err){_this5.destroy();throw err;})})})}else if(this.attributes.url&&this.attributes.metaData.__source==='external'){var data={name:this.attributes.name,ACL:this._acl,metaData:this.attributes.metaData,mime_type:this._guessedType,url:this.attributes.url};this._previousSave=AVRequest('files',this.attributes.name,null,'post',data).then(function(response){_this5.attributes.name=response.name;_this5.attributes.url=response.url;_this5.id=response.objectId;if(response.size){_this5.attributes.metaData.size=response.size}return _this5})}}return this._previousSave},fetch:function fetch(options){var _this6=this;var options=null;var request=AVRequest('files',null,this.id,'GET',options);return request.then(function(response){var value=AV.Object.prototype.parse(response);value.attributes={name:value.name,url:value.url};value.attributes.metaData=value.metaData||{};delete value.objectId;delete value.metaData;delete value.url;delete value.name;_.extend(_this6,value);return _this6})}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./browserify-wrapper/parse-base64":31,"./error":34,"./promise":45,"./request":49,"./uploader/cos":53,"./uploader/qiniu":54,"./uploader/s3":55,"underscore":21}],37:[function(require,module,exports){var _=require('underscore');module.exports=function(AV){AV.GeoPoint=function(arg1,arg2){if(_.isArray(arg1)){AV.GeoPoint._validate(arg1[0],arg1[1]);this.latitude=arg1[0];this.longitude=arg1[1]}else if(_.isObject(arg1)){AV.GeoPoint._validate(arg1.latitude,arg1.longitude);this.latitude=arg1.latitude;this.longitude=arg1.longitude}else if(_.isNumber(arg1)&&_.isNumber(arg2)){AV.GeoPoint._validate(arg1,arg2);this.latitude=arg1;this.longitude=arg2}else{this.latitude=0;this.longitude=0}var self=this;if(this.__defineGetter__&&this.__defineSetter__){this._latitude=this.latitude;this._longitude=this.longitude;this.__defineGetter__("latitude",function(){return self._latitude});this.__defineGetter__("longitude",function(){return self._longitude});this.__defineSetter__("latitude",function(val){AV.GeoPoint._validate(val,self.longitude);self._latitude=val});this.__defineSetter__("longitude",function(val){AV.GeoPoint._validate(self.latitude,val);self._longitude=val})}};AV.GeoPoint._validate=function(latitude,longitude){if(latitude<-90.0){throw new Error("AV.GeoPoint latitude "+latitude+" < -90.0.");}if(latitude>90.0){throw new Error("AV.GeoPoint latitude "+latitude+" > 90.0.");}if(longitude<-180.0){throw new Error("AV.GeoPoint longitude "+longitude+" < -180.0.");}if(longitude>180.0){throw new Error("AV.GeoPoint longitude "+longitude+" > 180.0.");}};AV.GeoPoint.current=function(){return new AV.Promise(function(resolve,reject){navigator.geolocation.getCurrentPosition(function(location){resolve(new AV.GeoPoint({latitude:location.coords.latitude,longitude:location.coords.longitude}))},reject)})};AV.GeoPoint.prototype={toJSON:function toJSON(){AV.GeoPoint._validate(this.latitude,this.longitude);return{"__type":"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function radiansTo(point){var d2r=Math.PI/180.0;var lat1rad=this.latitude*d2r;var long1rad=this.longitude*d2r;var lat2rad=point.latitude*d2r;var long2rad=point.longitude*d2r;var deltaLat=lat1rad-lat2rad;var deltaLong=long1rad-long2rad;var sinDeltaLatDiv2=Math.sin(deltaLat/2);var sinDeltaLongDiv2=Math.sin(deltaLong/2);var a=sinDeltaLatDiv2*sinDeltaLatDiv2+Math.cos(lat1rad)*Math.cos(lat2rad)*sinDeltaLongDiv2*sinDeltaLongDiv2;a=Math.min(1.0,a);return 2*Math.asin(Math.sqrt(a))},kilometersTo:function kilometersTo(point){return this.radiansTo(point)*6371.0},milesTo:function milesTo(point){return this.radiansTo(point)*3958.8}}}},{"underscore":21}],38:[function(require,module,exports){require('weapp-polyfill/auto-polyfill');module.exports=require('./index')},{"./index":39,"weapp-polyfill/auto-polyfill":22}],39:[function(require,module,exports){var AV=require('./av');AV._=require('underscore');AV.version=require('./version');AV.Promise=require('./promise');AV.localStorage=require('./localstorage');AV.Cache=require('./cache');AV.Error=require('./error');require('./init');require('./event')(AV);require('./geopoint')(AV);require('./acl')(AV);require('./op')(AV);require('./relation')(AV);require('./file')(AV);require('./object')(AV);require('./role')(AV);require('./user')(AV);require('./query')(AV);require('./cloudfunction')(AV);require('./push')(AV);require('./status')(AV);require('./search')(AV);require('./insight')(AV);module.exports=AV},{"./acl":28,"./av":29,"./cache":32,"./cloudfunction":33,"./error":34,"./event":35,"./file":36,"./geopoint":37,"./init":40,"./insight":41,"./localstorage":42,"./object":43,"./op":44,"./promise":45,"./push":46,"./query":47,"./relation":48,"./role":50,"./search":51,"./status":52,"./user":56,"./version":58,"underscore":21}],40:[function(require,module,exports){var AV=require('./av');var request=require('./request');var initialize=function initialize(appId,appKey,masterKey){if(AV.applicationId&&appId!==AV.applicationId&&appKey!==AV.applicationKey&&masterKey!==AV.masterKey){console.warn('LeanCloud SDK is already initialized, please do not reinitialize it.')}AV.applicationId=appId;AV.applicationKey=appKey;AV.masterKey=masterKey;AV._useMasterKey=false};var masterKeyWarn=function masterKeyWarn(){console.warn('MasterKey is not supposed to be used in browser.')};AV.init=function(){switch(arguments.length){case 1:var options=arguments.length<=0?undefined:arguments[0];if((typeof options==="undefined"?"undefined":_typeof(options))==='object'){if(!AV._config.isNode&&options.masterKey){masterKeyWarn()}initialize(options.appId,options.appKey,options.masterKey);request.setServerUrlByRegion(options.region);AV._config.disableCurrentUser=options.disableCurrentUser}else{throw new Error('AV.init(): Parameter is not correct.');}break;case 2:case 3:console.warn('Please use AV.init() to replace AV.initialize(), AV.init() need an Object param, like { appId: \'YOUR_APP_ID\', appKey: \'YOUR_APP_KEY\' } . Docs: https://leancloud.cn/docs/sdk_setup-js.html');if(!AV._config.isNode&&arguments.length===3){masterKeyWarn()}initialize.apply(undefined,arguments);request.setServerUrlByRegion('cn');break}};if(AV._config.isNode){AV.Cloud=AV.Cloud||{};AV.Cloud.useMasterKey=function(){AV._useMasterKey=true}}AV.initialize=AV.init},{"./av":29,"./request":49}],41:[function(require,module,exports){var _=require('underscore');var AVError=require('./error');var AVRequest=require('./request').request;module.exports=function(AV){AV.Insight=AV.Insight||{};_.extend(AV.Insight,{startJob:function startJob(jobConfig,options){if(!jobConfig||!jobConfig.sql){throw new Error('Please provide the sql to run the job.');}var data={jobConfig:jobConfig,appId:AV.applicationId};var request=AVRequest("bigquery",'jobs',null,'POST',AV._encode(data,null,true),options);return request.then(function(resp){return AV._decode(null,resp).id})},on:function on(event,cb){}});AV.Insight.JobQuery=function(id,className){if(!id){throw new Error('Please provide the job id.');}this.id=id;this.className=className;this._skip=0;this._limit=100};AV.Insight.JobQuery.prototype={skip:function skip(n){this._skip=n;return this},limit:function limit(n){this._limit=n;return this},find:function find(options){var params={skip:this._skip,limit:this._limit};var request=AVRequest("bigquery",'jobs',this.id,"GET",params,options);var self=this;return request.then(function(response){if(response.error){return AV.Promise.reject(new AVError(response.code,response.error))}return AV.Promise.resolve(response)})}}}},{"./error":34,"./request":49,"underscore":21}],42:[function(require,module,exports){var _=require('underscore');var Promise=require('./promise');var localStorage=require('./browserify-wrapper/localStorage');var syncApiNames=['getItem','setItem','removeItem','clear'];if(!localStorage.async){_(syncApiNames).each(function(apiName){if(typeof localStorage[apiName]==='function'){localStorage[apiName+'Async']=function(){return Promise.resolve(localStorage[apiName].apply(localStorage,arguments))}}})}else{_(syncApiNames).each(function(apiName){if(typeof localStorage[apiName]!=='function'){localStorage[apiName]=function(){var error=new Error('Synchronous API ['+apiName+'] is not available in this runtime.');error.code='SYNC_API_NOT_AVAILABLE';throw error;}}})}module.exports=localStorage},{"./browserify-wrapper/localStorage":30,"./promise":45,"underscore":21}],43:[function(require,module,exports){var _=require('underscore');var AVError=require('./error');var AVRequest=require('./request').request;var utils=require('./utils');var RESERVED_KEYS=['objectId','createdAt','updatedAt'];var checkReservedKey=function checkReservedKey(key){if(RESERVED_KEYS.indexOf(key)!==-1){throw new Error("key["+key+"] is reserved");}};module.exports=function(AV){AV.Object=function(attributes,options){if(_.isString(attributes)){return AV.Object._create.apply(this,arguments)}attributes=attributes||{};if(options&&options.parse){attributes=this.parse(attributes);attributes=this._mergeMagicFields(attributes)}var defaults=AV._getValue(this,'defaults');if(defaults){attributes=_.extend({},defaults,attributes)}if(options&&options.collection){this.collection=options.collection}this._serverData={};this._opSetQueue=[{}];this.attributes={};this._hashedJSON={};this._escapedAttributes={};this.cid=_.uniqueId('c');this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._hasData=true;this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments)};AV.Object.saveAll=function(list,options){return AV.Object._deepSaveAsync(list,null,options)};AV.Object.fetchAll=function(objects,options){return AV.Promise.resolve().then(function(){return AVRequest('batch',null,null,'POST',{requests:_.map(objects,function(object){if(!object.className)throw new Error('object must have className to fetch');if(!object.id)throw new Error('object must have id to fetch');if(object.dirty())throw new Error('object is modified but not saved');return{method:'GET',path:"/1.1/classes/"+object.className+"/"+object.id}})},options)}).then(function(response){_.forEach(objects,function(object,i){if(response[i].success){object._finishFetch(object.parse(response[i].success))}else{var error=new Error(response[i].error.error);error.code=response[i].error.code;throw error;}});return objects})};_.extend(AV.Object.prototype,AV.Events,{_fetchWhenSave:false,initialize:function initialize(){},fetchWhenSave:function fetchWhenSave(enable){console.warn('AV.Object#fetchWhenSave is deprecated, use AV.Object#save with options.fetchWhenSave instead.');if(!_.isBoolean(enable)){throw"Expect boolean value for fetchWhenSave";}this._fetchWhenSave=enable},getObjectId:function getObjectId(){return this.id},getCreatedAt:function getCreatedAt(){return this.createdAt||this.get('createdAt')},getUpdatedAt:function getUpdatedAt(){return this.updatedAt||this.get('updatedAt')},toJSON:function toJSON(){var json=this._toFullJSON();AV._arrayEach(["__type","className"],function(key){delete json[key]});return json},_toFullJSON:function _toFullJSON(seenObjects){var json=_.clone(this.attributes);AV._objectEach(json,function(val,key){json[key]=AV._encode(val,seenObjects)});AV._objectEach(this._operations,function(val,key){json[key]=val});if(_.has(this,"id")){json.objectId=this.id}if(_.has(this,"createdAt")){if(_.isDate(this.createdAt)){json.createdAt=this.createdAt.toJSON()}else{json.createdAt=this.createdAt}}if(_.has(this,"updatedAt")){if(_.isDate(this.updatedAt)){json.updatedAt=this.updatedAt.toJSON()}else{json.updatedAt=this.updatedAt}}json.__type="Object";json.className=this.className;return json},_refreshCache:function _refreshCache(){var self=this;if(self._refreshingCache){return}self._refreshingCache=true;AV._objectEach(this.attributes,function(value,key){if(value instanceof AV.Object){value._refreshCache()}else if(_.isObject(value)){if(self._resetCacheForKey(key)){self.set(key,new AV.Op.Set(value),{silent:true})}}});delete self._refreshingCache},dirty:function dirty(attr){this._refreshCache();var currentChanges=_.last(this._opSetQueue);if(attr){return currentChanges[attr]?true:false}if(!this.id){return true}if(_.keys(currentChanges).length>0){return true}return false},_toPointer:function _toPointer(){return{__type:"Pointer",className:this.className,objectId:this.id}},get:function get(attr){switch(attr){case'objectId':return this.id;case'createdAt':case'updatedAt':return this[attr];default:return this.attributes[attr]}},relation:function relation(attr){var value=this.get(attr);if(value){if(!(value instanceof AV.Relation)){throw"Called relation() on non-relation field "+attr;}value._ensureParentAndKey(this,attr);return value}else{return new AV.Relation(this,attr)}},escape:function escape(attr){var html=this._escapedAttributes[attr];if(html){return html}var val=this.attributes[attr];var escaped;if(utils.isNullOrUndefined(val)){escaped=''}else{escaped=_.escape(val.toString())}this._escapedAttributes[attr]=escaped;return escaped},has:function has(attr){return!utils.isNullOrUndefined(this.attributes[attr])},_mergeMagicFields:function _mergeMagicFields(attrs){var model=this;var specialFields=["objectId","createdAt","updatedAt"];AV._arrayEach(specialFields,function(attr){if(attrs[attr]){if(attr==="objectId"){model.id=attrs[attr]}else if((attr==="createdAt"||attr==="updatedAt")&&!_.isDate(attrs[attr])){model[attr]=AV._parseDate(attrs[attr])}else{model[attr]=attrs[attr]}delete attrs[attr]}});return attrs},_startSave:function _startSave(){this._opSetQueue.push({})},_cancelSave:function _cancelSave(){var self=this;var failedChanges=_.first(this._opSetQueue);this._opSetQueue=_.rest(this._opSetQueue);var nextChanges=_.first(this._opSetQueue);AV._objectEach(failedChanges,function(op,key){var op1=failedChanges[key];var op2=nextChanges[key];if(op1&&op2){nextChanges[key]=op2._mergeWithPrevious(op1)}else if(op1){nextChanges[key]=op1}});this._saving=this._saving-1},_finishSave:function _finishSave(serverData){var fetchedObjects={};AV._traverse(this.attributes,function(object){if(object instanceof AV.Object&&object.id&&object._hasData){fetchedObjects[object.id]=object}});var savedChanges=_.first(this._opSetQueue);this._opSetQueue=_.rest(this._opSetQueue);this._applyOpSet(savedChanges,this._serverData);this._mergeMagicFields(serverData);var self=this;AV._objectEach(serverData,function(value,key){self._serverData[key]=AV._decode(key,value);var fetched=AV._traverse(self._serverData[key],function(object){if(object instanceof AV.Object&&fetchedObjects[object.id]){return fetchedObjects[object.id]}});if(fetched){self._serverData[key]=fetched}});this._rebuildAllEstimatedData();this._saving=this._saving-1},_finishFetch:function _finishFetch(serverData,hasData){this._opSetQueue=[{}];this._mergeMagicFields(serverData);var self=this;AV._objectEach(serverData,function(value,key){self._serverData[key]=AV._decode(key,value)});this._rebuildAllEstimatedData();this._refreshCache();this._opSetQueue=[{}];this._hasData=hasData},_applyOpSet:function _applyOpSet(opSet,target){var self=this;AV._objectEach(opSet,function(change,key){target[key]=change._estimate(target[key],self,key);if(target[key]===AV.Op._UNSET){delete target[key]}})},_resetCacheForKey:function _resetCacheForKey(key){var value=this.attributes[key];if(_.isObject(value)&&!(value instanceof AV.Object)&&!(value instanceof AV.File)){value=value.toJSON?value.toJSON():value;var json=JSON.stringify(value);if(this._hashedJSON[key]!==json){var wasSet=!!this._hashedJSON[key];this._hashedJSON[key]=json;return wasSet}}return false},_rebuildEstimatedDataForKey:function _rebuildEstimatedDataForKey(key){var self=this;delete this.attributes[key];if(this._serverData[key]){this.attributes[key]=this._serverData[key]}AV._arrayEach(this._opSetQueue,function(opSet){var op=opSet[key];if(op){self.attributes[key]=op._estimate(self.attributes[key],self,key);if(self.attributes[key]===AV.Op._UNSET){delete self.attributes[key]}else{self._resetCacheForKey(key)}}})},_rebuildAllEstimatedData:function _rebuildAllEstimatedData(){var self=this;var previousAttributes=_.clone(this.attributes);this.attributes=_.clone(this._serverData);AV._arrayEach(this._opSetQueue,function(opSet){self._applyOpSet(opSet,self.attributes);AV._objectEach(opSet,function(op,key){self._resetCacheForKey(key)})});AV._objectEach(previousAttributes,function(oldValue,key){if(self.attributes[key]!==oldValue){self.trigger('change:'+key,self,self.attributes[key],{})}});AV._objectEach(this.attributes,function(newValue,key){if(!_.has(previousAttributes,key)){self.trigger('change:'+key,self,newValue,{})}})},set:function set(key,value,options){var attrs,attr;if(_.isObject(key)||utils.isNullOrUndefined(key)){attrs=key;AV._objectEach(attrs,function(v,k){checkReservedKey(k);attrs[k]=AV._decode(k,v)});options=value}else{attrs={};checkReservedKey(key);attrs[key]=AV._decode(key,value)}options=options||{};if(!attrs){return this}if(attrs instanceof AV.Object){attrs=attrs.attributes}if(options.unset){AV._objectEach(attrs,function(unused_value,key){attrs[key]=new AV.Op.Unset()})}var dataToValidate=_.clone(attrs);var self=this;AV._objectEach(dataToValidate,function(value,key){if(value instanceof AV.Op){dataToValidate[key]=value._estimate(self.attributes[key],self,key);if(dataToValidate[key]===AV.Op._UNSET){delete dataToValidate[key]}}});this._validate(attrs,options);options.changes={};var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};AV._arrayEach(_.keys(attrs),function(attr){var val=attrs[attr];if(val instanceof AV.Relation){val.parent=self}if(!(val instanceof AV.Op)){val=new AV.Op.Set(val)}var isRealChange=true;if(val instanceof AV.Op.Set&&_.isEqual(self.attributes[attr],val.value)){isRealChange=false}if(isRealChange){delete escaped[attr];if(options.silent){self._silent[attr]=true}else{options.changes[attr]=true}}var currentChanges=_.last(self._opSetQueue);currentChanges[attr]=val._mergeWithPrevious(currentChanges[attr]);self._rebuildEstimatedDataForKey(attr);if(isRealChange){self.changed[attr]=self.attributes[attr];if(!options.silent){self._pending[attr]=true}}else{delete self.changed[attr];delete self._pending[attr]}});if(!options.silent){this.change(options)}return this},unset:function unset(attr,options){options=options||{};options.unset=true;return this.set(attr,null,options)},increment:function increment(attr,amount){if(_.isUndefined(amount)||_.isNull(amount)){amount=1}return this.set(attr,new AV.Op.Increment(amount))},add:function add(attr,item){return this.set(attr,new AV.Op.Add(utils.ensureArray(item)))},addUnique:function addUnique(attr,item){return this.set(attr,new AV.Op.AddUnique(utils.ensureArray(item)))},remove:function remove(attr,item){return this.set(attr,new AV.Op.Remove(utils.ensureArray(item)))},op:function op(attr){return _.last(this._opSetQueue)[attr]},clear:function clear(options){options=options||{};options.unset=true;var keysToClear=_.extend(this.attributes,this._operations);return this.set(keysToClear,options)},_getSaveJSON:function _getSaveJSON(){var json=_.clone(_.first(this._opSetQueue));AV._objectEach(json,function(op,key){json[key]=op.toJSON()});return json},_canBeSerialized:function _canBeSerialized(){return AV.Object._canBeSerializedAsValue(this.attributes)},fetch:function fetch(){var fetchOptions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var options=arguments[1];if(_.isArray(fetchOptions.keys)){fetchOptions.keys=fetchOptions.keys.join(',')}if(_.isArray(fetchOptions.include)){fetchOptions.include=fetchOptions.include.join(',')}var self=this;var request=AVRequest('classes',this.className,this.id,'GET',fetchOptions,options);return request.then(function(response){self._finishFetch(self.parse(response),true);return self})},save:function save(arg1,arg2,arg3){var i,attrs,current,options,saved;if(_.isObject(arg1)||utils.isNullOrUndefined(arg1)){attrs=arg1;options=arg2}else{attrs={};attrs[arg1]=arg2;options=arg3}options=_.clone(options)||{};if(options.wait){current=_.clone(this.attributes)}var setOptions=_.clone(options)||{};if(setOptions.wait){setOptions.silent=true}if(attrs){this.set(attrs,setOptions)}var model=this;model._refreshCache();var unsavedChildren=[];var unsavedFiles=[];AV.Object._findUnsavedChildren(model.attributes,unsavedChildren,unsavedFiles);if(unsavedChildren.length+unsavedFiles.length>0){return AV.Object._deepSaveAsync(this.attributes,model,options).then(function(){return model.save(null,options)})}this._startSave();this._saving=(this._saving||0)+1;this._allPreviousSaves=this._allPreviousSaves||AV.Promise.resolve();this._allPreviousSaves=this._allPreviousSaves.catch(function(e){}).then(function(){var method=model.id?'PUT':'POST';var json=model._getSaveJSON();if(model._fetchWhenSave){json._fetchWhenSave=true}if(options.fetchWhenSave){json._fetchWhenSave=true}if(options.query){var queryJSON;if(typeof options.query.toJSON==='function'){queryJSON=options.query.toJSON();if(queryJSON){json._where=queryJSON.where}}if(!json._where){var error=new Error('options.query is not an AV.Query');throw error;}}var route="classes";var className=model.className;if(model.className==="_User"&&!model.id){route="users";className=null}var makeRequest=options._makeRequest||AVRequest;var request=makeRequest(route,className,model.id,method,json,options);request=request.then(function(resp){var serverAttrs=model.parse(resp);if(options.wait){serverAttrs=_.extend(attrs||{},serverAttrs)}model._finishSave(serverAttrs);if(options.wait){model.set(current,setOptions)}return model},function(error){model._cancelSave();throw error;});return request});return this._allPreviousSaves},destroy:function destroy(options){options=options||{};var model=this;var triggerDestroy=function triggerDestroy(){model.trigger('destroy',model,model.collection,options)};if(!this.id){return triggerDestroy()}if(!options.wait){triggerDestroy()}var request=AVRequest('classes',this.className,this.id,'DELETE',null,options);return request.then(function(){if(options.wait){triggerDestroy()}return model})},parse:function parse(resp){var output=_.clone(resp);_(["createdAt","updatedAt"]).each(function(key){if(output[key]){output[key]=AV._parseDate(output[key])}});if(!output.updatedAt){output.updatedAt=output.createdAt}return output},clone:function clone(){return new this.constructor(this.attributes)},isNew:function isNew(){return!this.id},change:function change(options){options=options||{};var changing=this._changing;this._changing=true;var self=this;AV._objectEach(this._silent,function(attr){self._pending[attr]=true});var changes=_.extend({},options.changes,this._silent);this._silent={};AV._objectEach(changes,function(unused_value,attr){self.trigger('change:'+attr,self,self.get(attr),options)});if(changing){return this}var deleteChanged=function deleteChanged(value,attr){if(!self._pending[attr]&&!self._silent[attr]){delete self.changed[attr]}};while(!_.isEmpty(this._pending)){this._pending={};this.trigger('change',this,options);AV._objectEach(this.changed,deleteChanged);self._previousAttributes=_.clone(this.attributes)}this._changing=false;return this},hasChanged:function hasChanged(attr){if(!arguments.length){return!_.isEmpty(this.changed)}return this.changed&&_.has(this.changed,attr)},changedAttributes:function changedAttributes(diff){if(!diff){return this.hasChanged()?_.clone(this.changed):false}var changed={};var old=this._previousAttributes;AV._objectEach(diff,function(diffVal,attr){if(!_.isEqual(old[attr],diffVal)){changed[attr]=diffVal}});return changed},previous:function previous(attr){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[attr]},previousAttributes:function previousAttributes(){return _.clone(this._previousAttributes)},isValid:function isValid(){try{this.validate(this.attributes)}catch(error){return false}return true},validate:function validate(attrs){if(_.has(attrs,"ACL")&&!(attrs.ACL instanceof AV.ACL)){throw new AVError(AVError.OTHER_CAUSE,"ACL must be a AV.ACL.");}},_validate:function _validate(attrs,options){if(options.silent||!this.validate){return}attrs=_.extend({},this.attributes,attrs);this.validate(attrs)},getACL:function getACL(){return this.get("ACL")},setACL:function setACL(acl,options){return this.set("ACL",acl,options)}});AV.Object.createWithoutData=function(className,id,hasData){var result=new AV.Object(className);result.id=id;result._hasData=hasData;return result};AV.Object.destroyAll=function(objects,options){options=options||{};if(!objects||objects.length===0){return AV.Promise.resolve()}var className=objects[0].className;var id="";var wasFirst=true;objects.forEach(function(obj){if(obj.className!=className)throw"AV.Object.destroyAll requires the argument object array's classNames must be the same";if(!obj.id)throw"Could not delete unsaved object";if(wasFirst){id=obj.id;wasFirst=false}else{id=id+','+obj.id}});var request=AVRequest('classes',className,id,'DELETE',null,options);return request};AV.Object._getSubclass=function(className){if(!_.isString(className)){throw"AV.Object._getSubclass requires a string argument.";}var ObjectClass=AV.Object._classMap[className];if(!ObjectClass){ObjectClass=AV.Object.extend(className);AV.Object._classMap[className]=ObjectClass}return ObjectClass};AV.Object._create=function(className,attributes,options){var ObjectClass=AV.Object._getSubclass(className);return new ObjectClass(attributes,options)};AV.Object._classMap={};AV.Object._extend=AV._extend;AV.Object['new']=function(attributes,options){return new AV.Object(attributes,options)};AV.Object.extend=function(className,protoProps,classProps){if(!_.isString(className)){if(className&&_.has(className,"className")){return AV.Object.extend(className.className,className,protoProps)}else{throw new Error("AV.Object.extend's first argument should be the className.");}}if(className==="User"){className="_User"}var NewClassObject=null;if(_.has(AV.Object._classMap,className)){var OldClassObject=AV.Object._classMap[className];if(protoProps||classProps){NewClassObject=OldClassObject._extend(protoProps,classProps)}else{return OldClassObject}}else{protoProps=protoProps||{};protoProps._className=className;NewClassObject=this._extend(protoProps,classProps)}NewClassObject.extend=function(arg0){if(_.isString(arg0)||arg0&&_.has(arg0,"className")){return AV.Object.extend.apply(NewClassObject,arguments)}var newArguments=[className].concat(_.toArray(arguments));return AV.Object.extend.apply(NewClassObject,newArguments)};NewClassObject['new']=function(attributes,options){return new NewClassObject(attributes,options)};AV.Object._classMap[className]=NewClassObject;return NewClassObject};Object.defineProperty(AV.Object.prototype,'className',{get:function get(){var className=this._className||this.constructor.name;if(className==="User"){return"_User"}return className}});AV.Object.register=function(klass){if(!(klass.prototype instanceof AV.Object)){throw new Error('registered class is not a subclass of AV.Object');}var className=klass.name;if(!className.length){throw new Error('registered class must be named');}AV.Object._classMap[className]=klass};AV.Object._findUnsavedChildren=function(object,children,files){AV._traverse(object,function(object){if(object instanceof AV.Object){object._refreshCache();if(object.dirty()){children.push(object)}return}if(object instanceof AV.File){if(!object.url()&&!object.id){files.push(object)}return}})};AV.Object._canBeSerializedAsValue=function(object){var canBeSerializedAsValue=true;if(object instanceof AV.Object||object instanceof AV.File){canBeSerializedAsValue=!!object.id}else if(_.isArray(object)){AV._arrayEach(object,function(child){if(!AV.Object._canBeSerializedAsValue(child)){canBeSerializedAsValue=false}})}else if(_.isObject(object)){AV._objectEach(object,function(child){if(!AV.Object._canBeSerializedAsValue(child)){canBeSerializedAsValue=false}})}return canBeSerializedAsValue};AV.Object._deepSaveAsync=function(object,model,options){var unsavedChildren=[];var unsavedFiles=[];AV.Object._findUnsavedChildren(object,unsavedChildren,unsavedFiles);if(model){unsavedChildren=_.filter(unsavedChildren,function(object){return object!=model})}var promise=AV.Promise.resolve();_.each(unsavedFiles,function(file){promise=promise.then(function(){return file.save()})});var objects=_.uniq(unsavedChildren);var remaining=_.uniq(objects);return promise.then(function(){return AV.Promise._continueWhile(function(){return remaining.length>0},function(){var batch=[];var newRemaining=[];AV._arrayEach(remaining,function(object){if(batch.length>20){newRemaining.push(object);return}if(object._canBeSerialized()){batch.push(object)}else{newRemaining.push(object)}});remaining=newRemaining;if(batch.length===0){return AV.Promise.reject(new AVError(AVError.OTHER_CAUSE,"Tried to save a batch with a cycle."))}var readyToStart=AV.Promise.resolve(_.map(batch,function(object){return object._allPreviousSaves||AV.Promise.resolve()}));var bathSavePromise=readyToStart.then(function(){return AVRequest("batch",null,null,"POST",{requests:_.map(batch,function(object){var json=object._getSaveJSON();var method="POST";var path="/1.1/classes/"+object.className;if(object.id){path=path+"/"+object.id;method="PUT"}object._startSave();return{method:method,path:path,body:json}})},options).then(function(response){var error;AV._arrayEach(batch,function(object,i){if(response[i].success){object._finishSave(object.parse(response[i].success))}else{error=error||response[i].error;object._cancelSave()}});if(error){return AV.Promise.reject(new AVError(error.code,error.error))}})});AV._arrayEach(batch,function(object){object._allPreviousSaves=bathSavePromise});return bathSavePromise})}).then(function(){return object})}}},{"./error":34,"./request":49,"./utils":57,"underscore":21}],44:[function(require,module,exports){var _=require('underscore');module.exports=function(AV){AV.Op=function(){this._initialize.apply(this,arguments)};AV.Op.prototype={_initialize:function _initialize(){}};_.extend(AV.Op,{_extend:AV._extend,_opDecoderMap:{},_registerDecoder:function _registerDecoder(opName,decoder){AV.Op._opDecoderMap[opName]=decoder},_decode:function _decode(json){var decoder=AV.Op._opDecoderMap[json.__op];if(decoder){return decoder(json)}else{return undefined}}});AV.Op._registerDecoder("Batch",function(json){var op=null;AV._arrayEach(json.ops,function(nextOp){nextOp=AV.Op._decode(nextOp);op=nextOp._mergeWithPrevious(op)});return op});AV.Op.Set=AV.Op._extend({_initialize:function _initialize(value){this._value=value},value:function value(){return this._value},toJSON:function toJSON(){return AV._encode(this.value())},_mergeWithPrevious:function _mergeWithPrevious(previous){return this},_estimate:function _estimate(oldValue){return this.value()}});AV.Op._UNSET={};AV.Op.Unset=AV.Op._extend({toJSON:function toJSON(){return{__op:"Delete"}},_mergeWithPrevious:function _mergeWithPrevious(previous){return this},_estimate:function _estimate(oldValue){return AV.Op._UNSET}});AV.Op._registerDecoder("Delete",function(json){return new AV.Op.Unset()});AV.Op.Increment=AV.Op._extend({_initialize:function _initialize(amount){this._amount=amount},amount:function amount(){return this._amount},toJSON:function toJSON(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function _mergeWithPrevious(previous){if(!previous){return this}else if(previous instanceof AV.Op.Unset){return new AV.Op.Set(this.amount())}else if(previous instanceof AV.Op.Set){return new AV.Op.Set(previous.value()+this.amount())}else if(previous instanceof AV.Op.Increment){return new AV.Op.Increment(this.amount()+previous.amount())}else{throw"Op is invalid after previous op.";}},_estimate:function _estimate(oldValue){if(!oldValue){return this.amount()}return oldValue+this.amount()}});AV.Op._registerDecoder("Increment",function(json){return new AV.Op.Increment(json.amount)});AV.Op.Add=AV.Op._extend({_initialize:function _initialize(objects){this._objects=objects},objects:function objects(){return this._objects},toJSON:function toJSON(){return{__op:"Add",objects:AV._encode(this.objects())}},_mergeWithPrevious:function _mergeWithPrevious(previous){if(!previous){return this}else if(previous instanceof AV.Op.Unset){return new AV.Op.Set(this.objects())}else if(previous instanceof AV.Op.Set){return new AV.Op.Set(this._estimate(previous.value()))}else if(previous instanceof AV.Op.Add){return new AV.Op.Add(previous.objects().concat(this.objects()))}else{throw"Op is invalid after previous op.";}},_estimate:function _estimate(oldValue){if(!oldValue){return _.clone(this.objects())}else{return oldValue.concat(this.objects())}}});AV.Op._registerDecoder("Add",function(json){return new AV.Op.Add(AV._decode(undefined,json.objects))});AV.Op.AddUnique=AV.Op._extend({_initialize:function _initialize(objects){this._objects=_.uniq(objects)},objects:function objects(){return this._objects},toJSON:function toJSON(){return{__op:"AddUnique",objects:AV._encode(this.objects())}},_mergeWithPrevious:function _mergeWithPrevious(previous){if(!previous){return this}else if(previous instanceof AV.Op.Unset){return new AV.Op.Set(this.objects())}else if(previous instanceof AV.Op.Set){return new AV.Op.Set(this._estimate(previous.value()))}else if(previous instanceof AV.Op.AddUnique){return new AV.Op.AddUnique(this._estimate(previous.objects()))}else{throw"Op is invalid after previous op.";}},_estimate:function _estimate(oldValue){if(!oldValue){return _.clone(this.objects())}else{var newValue=_.clone(oldValue);AV._arrayEach(this.objects(),function(obj){if(obj instanceof AV.Object&&obj.id){var matchingObj=_.find(newValue,function(anObj){return anObj instanceof AV.Object&&anObj.id===obj.id});if(!matchingObj){newValue.push(obj)}else{var index=_.indexOf(newValue,matchingObj);newValue[index]=obj}}else if(!_.contains(newValue,obj)){newValue.push(obj)}});return newValue}}});AV.Op._registerDecoder("AddUnique",function(json){return new AV.Op.AddUnique(AV._decode(undefined,json.objects))});AV.Op.Remove=AV.Op._extend({_initialize:function _initialize(objects){this._objects=_.uniq(objects)},objects:function objects(){return this._objects},toJSON:function toJSON(){return{__op:"Remove",objects:AV._encode(this.objects())}},_mergeWithPrevious:function _mergeWithPrevious(previous){if(!previous){return this}else if(previous instanceof AV.Op.Unset){return previous}else if(previous instanceof AV.Op.Set){return new AV.Op.Set(this._estimate(previous.value()))}else if(previous instanceof AV.Op.Remove){return new AV.Op.Remove(_.union(previous.objects(),this.objects()))}else{throw"Op is invalid after previous op.";}},_estimate:function _estimate(oldValue){if(!oldValue){return[]}else{var newValue=_.difference(oldValue,this.objects());AV._arrayEach(this.objects(),function(obj){if(obj instanceof AV.Object&&obj.id){newValue=_.reject(newValue,function(other){return other instanceof AV.Object&&other.id===obj.id})}});return newValue}}});AV.Op._registerDecoder("Remove",function(json){return new AV.Op.Remove(AV._decode(undefined,json.objects))});AV.Op.Relation=AV.Op._extend({_initialize:function _initialize(adds,removes){this._targetClassName=null;var self=this;var pointerToId=function pointerToId(object){if(object instanceof AV.Object){if(!object.id){throw"You can't add an unsaved AV.Object to a relation.";}if(!self._targetClassName){self._targetClassName=object.className}if(self._targetClassName!==object.className){throw"Tried to create a AV.Relation with 2 different types: "+self._targetClassName+" and "+object.className+".";}return object.id}return object};this.relationsToAdd=_.uniq(_.map(adds,pointerToId));this.relationsToRemove=_.uniq(_.map(removes,pointerToId))},added:function added(){var self=this;return _.map(this.relationsToAdd,function(objectId){var object=AV.Object._create(self._targetClassName);object.id=objectId;return object})},removed:function removed(){var self=this;return _.map(this.relationsToRemove,function(objectId){var object=AV.Object._create(self._targetClassName);object.id=objectId;return object})},toJSON:function toJSON(){var adds=null;var removes=null;var self=this;var idToPointer=function idToPointer(id){return{__type:'Pointer',className:self._targetClassName,objectId:id}};var pointers=null;if(this.relationsToAdd.length>0){pointers=_.map(this.relationsToAdd,idToPointer);adds={"__op":"AddRelation","objects":pointers}}if(this.relationsToRemove.length>0){pointers=_.map(this.relationsToRemove,idToPointer);removes={"__op":"RemoveRelation","objects":pointers}}if(adds&&removes){return{"__op":"Batch","ops":[adds,removes]}}return adds||removes||{}},_mergeWithPrevious:function _mergeWithPrevious(previous){if(!previous){return this}else if(previous instanceof AV.Op.Unset){throw"You can't modify a relation after deleting it.";}else if(previous instanceof AV.Op.Relation){if(previous._targetClassName&&previous._targetClassName!==this._targetClassName){throw"Related object must be of class "+previous._targetClassName+", but "+this._targetClassName+" was passed in.";}var newAdd=_.union(_.difference(previous.relationsToAdd,this.relationsToRemove),this.relationsToAdd);var newRemove=_.union(_.difference(previous.relationsToRemove,this.relationsToAdd),this.relationsToRemove);var newRelation=new AV.Op.Relation(newAdd,newRemove);newRelation._targetClassName=this._targetClassName;return newRelation}else{throw"Op is invalid after previous op.";}},_estimate:function _estimate(oldValue,object,key){if(!oldValue){var relation=new AV.Relation(object,key);relation.targetClassName=this._targetClassName}else if(oldValue instanceof AV.Relation){if(this._targetClassName){if(oldValue.targetClassName){if(oldValue.targetClassName!==this._targetClassName){throw"Related object must be a "+oldValue.targetClassName+", but a "+this._targetClassName+" was passed in.";}}else{oldValue.targetClassName=this._targetClassName}}return oldValue}else{throw"Op is invalid after previous op.";}}});AV.Op._registerDecoder("AddRelation",function(json){return new AV.Op.Relation(AV._decode(undefined,json.objects),[])});AV.Op._registerDecoder("RemoveRelation",function(json){return new AV.Op.Relation([],AV._decode(undefined,json.objects))})}},{"underscore":21}],45:[function(require,module,exports){var _=require('underscore');var Promise=require('rsvp').Promise;Promise._continueWhile=function(predicate,asyncFunction){if(predicate()){return asyncFunction().then(function(){return Promise._continueWhile(predicate,asyncFunction)})}return Promise.resolve()};module.exports=Promise},{"rsvp":16,"underscore":21}],46:[function(require,module,exports){var AVRequest=require('./request').request;module.exports=function(AV){AV.Installation=AV.Object.extend("_Installation");AV.Push=AV.Push||{};AV.Push.send=function(data,options){if(data.where){data.where=data.where.toJSON().where}if(data.where&&data.cql){throw new Error("Both where and cql can't be set");}if(data.push_time){data.push_time=data.push_time.toJSON()}if(data.expiration_time){data.expiration_time=data.expiration_time.toJSON()}if(data.expiration_time&&data.expiration_time_interval){throw new Error("Both expiration_time and expiration_time_interval can't be set");}var request=AVRequest('push',null,null,'POST',data,options);return request}}},{"./request":49}],47:[function(require,module,exports){var _=require('underscore');var AVError=require('./error');var AVRequest=require('./request').request;var _require2=require('./utils'),ensureArray=_require2.ensureArray;var requires=function requires(value,message){if(value===undefined){throw new Error(message);}};module.exports=function(AV){AV.Query=function(objectClass){if(_.isString(objectClass)){objectClass=AV.Object._getSubclass(objectClass)}this.objectClass=objectClass;this.className=objectClass.prototype.className;this._where={};this._include=[];this._select=[];this._limit=-1;this._skip=0;this._extraOptions={}};AV.Query.or=function(){var queries=_.toArray(arguments);var className=null;AV._arrayEach(queries,function(q){if(_.isNull(className)){className=q.className}if(className!==q.className){throw"All queries must be for the same class";}});var query=new AV.Query(className);query._orQuery(queries);return query};AV.Query.and=function(){var queries=_.toArray(arguments);var className=null;AV._arrayEach(queries,function(q){if(_.isNull(className)){className=q.className}if(className!==q.className){throw"All queries must be for the same class";}});var query=new AV.Query(className);query._andQuery(queries);return query};AV.Query.doCloudQuery=function(cql,pvalues,options){var params={cql:cql};if(_.isArray(pvalues)){params.pvalues=pvalues}else{options=pvalues}var request=AVRequest('cloudQuery',null,null,'GET',params,options);return request.then(function(response){var query=new AV.Query(response.className);var results=_.map(response.results,function(json){var obj=query._newObject(response);if(obj._finishFetch){obj._finishFetch(query._processResult(json),true)}return obj});return{results:results,count:response.count,className:response.className}})};AV.Query._extend=AV._extend;AV.Query.prototype={_processResult:function _processResult(obj){return obj},get:function get(objectId,options){if(!objectId){var errorObject=new AVError(AVError.OBJECT_NOT_FOUND,"Object not found.");throw errorObject;}var self=this;var obj=self._newObject();obj.id=objectId;var queryJSON=self.toJSON();var fetchOptions={};if(queryJSON.keys)fetchOptions.keys=queryJSON.keys;if(queryJSON.include)fetchOptions.include=queryJSON.include;return obj.fetch(fetchOptions,options)},toJSON:function toJSON(){var params={where:this._where};if(this._include.length>0){params.include=this._include.join(",")}if(this._select.length>0){params.keys=this._select.join(",")}if(this._limit>=0){params.limit=this._limit}if(this._skip>0){params.skip=this._skip}if(this._order!==undefined){params.order=this._order}AV._objectEach(this._extraOptions,function(v,k){params[k]=v});return params},_newObject:function _newObject(response){var obj;if(response&&response.className){obj=new AV.Object(response.className)}else{obj=new this.objectClass()}return obj},_createRequest:function _createRequest(params,options){return AVRequest('classes',this.className,null,"GET",params||this.toJSON(),options)},find:function find(options){var self=this;var request=this._createRequest(null,options);return request.then(function(response){return _.map(response.results,function(json){var obj=self._newObject(response);if(obj._finishFetch){obj._finishFetch(self._processResult(json),true)}return obj})})},destroyAll:function destroyAll(options){var self=this;return self.find(options).then(function(objects){return AV.Object.destroyAll(objects)})},count:function count(options){var params=this.toJSON();params.limit=0;params.count=1;var request=this._createRequest(params,options);return request.then(function(response){return response.count})},first:function first(options){var self=this;var params=this.toJSON();params.limit=1;var request=this._createRequest(params,options);return request.then(function(response){return _.map(response.results,function(json){var obj=self._newObject();if(obj._finishFetch){obj._finishFetch(self._processResult(json),true)}return obj})[0]})},skip:function skip(n){requires(n,'undefined is not a valid skip value');this._skip=n;return this},limit:function limit(n){requires(n,'undefined is not a valid limit value');this._limit=n;return this},equalTo:function equalTo(key,value){requires(key,'undefined is not a valid key');requires(value,'undefined is not a valid value');this._where[key]=AV._encode(value);return this},_addCondition:function _addCondition(key,condition,value){requires(key,'undefined is not a valid condition key');requires(condition,'undefined is not a valid condition');requires(value,'undefined is not a valid condition value');if(!this._where[key]){this._where[key]={}}this._where[key][condition]=AV._encode(value);return this},sizeEqualTo:function sizeEqualTo(key,value){this._addCondition(key,"$size",value)},notEqualTo:function notEqualTo(key,value){this._addCondition(key,"$ne",value);return this},lessThan:function lessThan(key,value){this._addCondition(key,"$lt",value);return this},greaterThan:function greaterThan(key,value){this._addCondition(key,"$gt",value);return this},lessThanOrEqualTo:function lessThanOrEqualTo(key,value){this._addCondition(key,"$lte",value);return this},greaterThanOrEqualTo:function greaterThanOrEqualTo(key,value){this._addCondition(key,"$gte",value);return this},containedIn:function containedIn(key,values){this._addCondition(key,"$in",values);return this},notContainedIn:function notContainedIn(key,values){this._addCondition(key,"$nin",values);return this},containsAll:function containsAll(key,values){this._addCondition(key,"$all",values);return this},exists:function exists(key){this._addCondition(key,"$exists",true);return this},doesNotExist:function doesNotExist(key){this._addCondition(key,"$exists",false);return this},matches:function matches(key,regex,modifiers){this._addCondition(key,"$regex",regex);if(!modifiers){modifiers=""}if(regex.ignoreCase){modifiers+='i'}if(regex.multiline){modifiers+='m'}if(modifiers&&modifiers.length){this._addCondition(key,"$options",modifiers)}return this},matchesQuery:function matchesQuery(key,query){var queryJSON=query.toJSON();queryJSON.className=query.className;this._addCondition(key,"$inQuery",queryJSON);return this},doesNotMatchQuery:function doesNotMatchQuery(key,query){var queryJSON=query.toJSON();queryJSON.className=query.className;this._addCondition(key,"$notInQuery",queryJSON);return this},matchesKeyInQuery:function matchesKeyInQuery(key,queryKey,query){var queryJSON=query.toJSON();queryJSON.className=query.className;this._addCondition(key,"$select",{key:queryKey,query:queryJSON});return this},doesNotMatchKeyInQuery:function doesNotMatchKeyInQuery(key,queryKey,query){var queryJSON=query.toJSON();queryJSON.className=query.className;this._addCondition(key,"$dontSelect",{key:queryKey,query:queryJSON});return this},_orQuery:function _orQuery(queries){var queryJSON=_.map(queries,function(q){return q.toJSON().where});this._where.$or=queryJSON;return this},_andQuery:function _andQuery(queries){var queryJSON=_.map(queries,function(q){return q.toJSON().where});this._where.$and=queryJSON;return this},_quote:function _quote(s){return"\\Q"+s.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function contains(key,value){this._addCondition(key,"$regex",this._quote(value));return this},startsWith:function startsWith(key,value){this._addCondition(key,"$regex","^"+this._quote(value));return this},endsWith:function endsWith(key,value){this._addCondition(key,"$regex",this._quote(value)+"$");return this},ascending:function ascending(key){requires(key,'undefined is not a valid key');this._order=key;return this},addAscending:function addAscending(key){requires(key,'undefined is not a valid key');if(this._order)this._order+=','+key;else this._order=key;return this},descending:function descending(key){requires(key,'undefined is not a valid key');this._order="-"+key;return this},addDescending:function addDescending(key){requires(key,'undefined is not a valid key');if(this._order)this._order+=',-'+key;else this._order='-'+key;return this},near:function near(key,point){if(!(point instanceof AV.GeoPoint)){point=new AV.GeoPoint(point)}this._addCondition(key,"$nearSphere",point);return this},withinRadians:function withinRadians(key,point,distance){this.near(key,point);this._addCondition(key,"$maxDistance",distance);return this},withinMiles:function withinMiles(key,point,distance){return this.withinRadians(key,point,distance/3958.8)},withinKilometers:function withinKilometers(key,point,distance){return this.withinRadians(key,point,distance/6371.0)},withinGeoBox:function withinGeoBox(key,southwest,northeast){if(!(southwest instanceof AV.GeoPoint)){southwest=new AV.GeoPoint(southwest)}if(!(northeast instanceof AV.GeoPoint)){northeast=new AV.GeoPoint(northeast)}this._addCondition(key,'$within',{'$box':[southwest,northeast]});return this},include:function include(keys){var _this7=this;requires(keys,'undefined is not a valid key');_(arguments).forEach(function(keys){_this7._include=_this7._include.concat(ensureArray(keys))});return this},select:function select(keys){var _this8=this;requires(keys,'undefined is not a valid key');_(arguments).forEach(function(keys){_this8._select=_this8._select.concat(ensureArray(keys))});return this},each:function each(callback){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this._order||this._skip||this._limit>=0){var error=new Error("Cannot iterate on a query with sort, skip, or limit.");return AV.Promise.reject(error)}var query=new AV.Query(this.objectClass);query._limit=options.batchSize||100;query._where=_.clone(this._where);query._include=_.clone(this._include);query.ascending('objectId');var finished=false;return AV.Promise._continueWhile(function(){return!finished},function(){return query.find(options).then(function(results){var callbacksDone=AV.Promise.resolve();_.each(results,function(result){callbacksDone=callbacksDone.then(function(){return callback(result)})});return callbacksDone.then(function(){if(results.length>=query._limit){query.greaterThan("objectId",results[results.length-1].id)}else{finished=true}})})})}};AV.FriendShipQuery=AV.Query._extend({_objectClass:AV.User,_newObject:function _newObject(){return new AV.User()},_processResult:function _processResult(json){if(json&&json[this._friendshipTag]){var user=json[this._friendshipTag];if(user.__type==='Pointer'&&user.className==='_User'){delete user.__type;delete user.className}return user}else{return null}}})}},{"./error":34,"./request":49,"./utils":57,"underscore":21}],48:[function(require,module,exports){var _=require('underscore');module.exports=function(AV){AV.Relation=function(parent,key){if(!_.isString(key)){throw new TypeError('key must be a string');}this.parent=parent;this.key=key;this.targetClassName=null};AV.Relation.reverseQuery=function(parentClass,relationKey,child){var query=new AV.Query(parentClass);query.equalTo(relationKey,child._toPointer());return query};AV.Relation.prototype={_ensureParentAndKey:function _ensureParentAndKey(parent,key){this.parent=this.parent||parent;this.key=this.key||key;if(this.parent!==parent){throw new Error("Internal Error. Relation retrieved from two different Objects.");}if(this.key!==key){throw new Error("Internal Error. Relation retrieved from two different keys.");}},add:function add(objects){if(!_.isArray(objects)){objects=[objects]}var change=new AV.Op.Relation(objects,[]);this.parent.set(this.key,change);this.targetClassName=change._targetClassName},remove:function remove(objects){if(!_.isArray(objects)){objects=[objects]}var change=new AV.Op.Relation([],objects);this.parent.set(this.key,change);this.targetClassName=change._targetClassName},toJSON:function toJSON(){return{"__type":"Relation","className":this.targetClassName}},query:function query(){var targetClass;var query;if(!this.targetClassName){targetClass=AV.Object._getSubclass(this.parent.className);query=new AV.Query(targetClass);query._extraOptions.redirectClassNameForKey=this.key}else{targetClass=AV.Object._getSubclass(this.targetClassName);query=new AV.Query(targetClass)}query._addCondition("$relatedTo","object",this.parent._toPointer());query._addCondition("$relatedTo","key",this.key);return query}}}},{"underscore":21}],49:[function(require,module,exports){(function(process){var request=require('superagent');var debug=require('debug')('leancloud:request');var md5=require('md5');var Promise=require('./promise');var Cache=require('./cache');var AVError=require('./error');var AV=require('./av');var _=require('underscore');var _require3=require('./utils'),getSessionToken=_require3.getSessionToken;var getServerURLPromise=void 0;var API_HOST={cn:'https://api.leancloud.cn',us:'https://us-api.leancloud.cn'};var sign=function sign(key,isMasterKey){var now=new Date().getTime();var signature=md5(now+key);if(isMasterKey){return signature+","+now+",master"}return signature+","+now};var checkRouter=function checkRouter(router){var routerList=['batch','classes','files','date','functions','call','login','push','search/select','requestPasswordReset','requestEmailVerify','requestPasswordResetBySmsCode','resetPasswordBySmsCode','requestMobilePhoneVerify','requestLoginSmsCode','verifyMobilePhone','requestSmsCode','verifySmsCode','users','usersByMobilePhone','cloudQuery','qiniu','fileTokens','statuses','bigquery','search/select','subscribe/statuses/count','subscribe/statuses','installations'];if(routerList.indexOf(router)===-1&&!/users\/[^\/]+\/updatePassword/.test(router)&&!/users\/[^\/]+\/friendship\/[^\/]+/.test(router)){throw new Error("Bad router: "+router+".");}};var requestsCount=0;var ajax=function ajax(method,resourceUrl,data){var headers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var onprogress=arguments[4];var count=requestsCount++;debug("request("+count+")",method,resourceUrl,data,headers);return new Promise(function(resolve,reject){var req=request(method,resourceUrl).set(headers).send(data);if(onprogress){req.on('progress',onprogress)}req.end(function(err,res){if(res){debug("response("+count+")",res.status,res.body||res.text,res.header)}if(err){if(res){err.statusCode=res.status;err.responseText=res.text;err.response=res.body}return reject(err)}return resolve(res.body)})})};var setHeaders=function setHeaders(){var authOptions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var headers={'X-LC-Id':AV.applicationId,'Content-Type':'application/json;charset=UTF-8'};var useMasterKey=false;if(typeof authOptions.useMasterKey==='boolean'){useMasterKey=authOptions.useMasterKey}else if(typeof AV._useMasterKey==='boolean'){useMasterKey=AV._useMasterKey}if(useMasterKey){if(AV.masterKey){headers['X-LC-Sign']=sign(AV.masterKey,true)}else{console.warn('masterKey is not set, fall back to use appKey');headers['X-LC-Sign']=sign(AV.applicationKey)}}else{headers['X-LC-Sign']=sign(AV.applicationKey)}if(AV._config.applicationProduction!==null){headers['X-LC-Prod']=AV._config.applicationProduction}if(!AV._config.isNode){headers['X-LC-UA']="AV/"+AV.version}else{headers['User-Agent']=AV._config.userAgent||"AV/"+AV.version+"; Node.js/"+process.version}return Promise.resolve().then(function(){var sessionToken=getSessionToken(authOptions);if(sessionToken){headers['X-LC-Session']=sessionToken}else if(!AV._config.disableCurrentUser){return AV.User.currentAsync().then(function(currentUser){if(currentUser&&currentUser._sessionToken){headers['X-LC-Session']=currentUser._sessionToken}return headers})}return headers})};var createApiUrl=function createApiUrl(route,className,objectId,method,dataObject){if(AV.serverURL){AV._config.APIServerURL=AV.serverURL;console.warn('Please use AV._config.APIServerURL to replace AV.serverURL, and it is an internal interface.')}var apiURL=AV._config.APIServerURL||API_HOST.cn;if(apiURL.charAt(apiURL.length-1)!=='/'){apiURL+='/'}apiURL+="1.1/"+route;if(className){apiURL+="/"+className}if(objectId){apiURL+="/"+objectId}if((route==='users'||route==='classes')&&dataObject){apiURL+='?';if(dataObject._fetchWhenSave){delete dataObject._fetchWhenSave;apiURL+='&new=true'}if(dataObject._where){apiURL+="&where="+encodeURIComponent(JSON.stringify(dataObject._where));delete dataObject._where}}if(method.toLowerCase()==='get'){if(apiURL.indexOf('?')===-1){apiURL+='?'}for(var k in dataObject){if(_typeof(dataObject[k])==='object'){dataObject[k]=JSON.stringify(dataObject[k])}apiURL+="&"+k+"="+encodeURIComponent(dataObject[k])}}return apiURL};var cacheServerURL=function cacheServerURL(serverURL,ttl){if(typeof ttl!=='number'){ttl=3600}return Cache.setAsync('APIServerURL',serverURL,ttl*1000)};var handleError=function handleError(res){return new Promise(function(resolve,reject){if(res.statusCode===410){cacheServerURL(res.response.api_server,res.response.ttl).then(function(){resolve(res.response.location)}).catch(function(error){reject(error)})}else{var errorJSON={code:-1,error:res.responseText};if(res.response&&res.response.code){errorJSON=res.response}else if(res.responseText){try{errorJSON=JSON.parse(res.responseText)}catch(e){}}var error=new AVError(errorJSON.code,errorJSON.error);reject(error)}})};var setServerUrl=function setServerUrl(serverURL){AV._config.APIServerURL="https://"+serverURL;var newRegion=_.findKey(API_HOST,function(item){return item===AV._config.APIServerURL});if(newRegion){AV._config.region=newRegion}};var refreshServerUrlByRouter=function refreshServerUrlByRouter(){var url="https://app-router.leancloud.cn/1/route?appId="+AV.applicationId;return ajax('get',url).then(function(servers){if(servers.api_server){setServerUrl(servers.api_server);return cacheServerURL(servers.api_server,servers.ttl)}},function(error){if(error.statusCode>=400&&error.statusCode<500){throw error;}})};var setServerUrlByRegion=function setServerUrlByRegion(){var region=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'cn';getServerURLPromise=new Promise(function(resolve,reject){if(AV._config.APIServerURL){resolve();return}if(region==='cn'){return Cache.getAsync('APIServerURL').then(function(serverURL){if(serverURL){setServerUrl(serverURL)}else{return refreshServerUrlByRouter()}}).then(function(){resolve()}).catch(function(error){reject(error)})}else{AV._config.region=region;AV._config.APIServerURL=API_HOST[region];resolve()}})};var AVRequest=function AVRequest(route,className,objectId,method){var dataObject=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var authOptions=arguments[5];if(!AV.applicationId){throw new Error('You must specify your applicationId using AV.init()');}if(!AV.applicationKey&&!AV.masterKey){throw new Error('You must specify a AppKey using AV.init()');}checkRouter(route);if(!getServerURLPromise){return Promise.reject(new Error('Not initialized'))}return getServerURLPromise.then(function(){var apiURL=createApiUrl(route,className,objectId,method,dataObject);return setHeaders(authOptions).then(function(headers){return ajax(method,apiURL,dataObject,headers).then(null,function(res){return handleError(res).then(function(location){return ajax(method,location,dataObject,headers)})})})})};module.exports={ajax:ajax,request:AVRequest,setServerUrlByRegion:setServerUrlByRegion}}).call(this,require('_process'))},{"./av":29,"./cache":32,"./error":34,"./promise":45,"./utils":57,"_process":15,"debug":5,"md5":13,"superagent":17,"underscore":21}],50:[function(require,module,exports){var _=require('underscore');var AVError=require('./error');module.exports=function(AV){AV.Role=AV.Object.extend("_Role",{constructor:function constructor(name,acl){if(_.isString(name)){AV.Object.prototype.constructor.call(this,null,null);this.setName(name)}else{AV.Object.prototype.constructor.call(this,name,acl)}if(acl===undefined){var defaultAcl=new AV.ACL();defaultAcl.setPublicReadAccess(true);if(!this.getACL()){this.setACL(defaultAcl)}}else if(!(acl instanceof AV.ACL)){throw new TypeError('acl must be an instance of AV.ACL');}else{this.setACL(acl)}},getName:function getName(){return this.get("name")},setName:function setName(name,options){return this.set("name",name,options)},getUsers:function getUsers(){return this.relation("users")},getRoles:function getRoles(){return this.relation("roles")},validate:function validate(attrs,options){if("name"in attrs&&attrs.name!==this.getName()){var newName=attrs.name;if(this.id&&this.id!==attrs.objectId){return new AVError(AVError.OTHER_CAUSE,"A role's name can only be set before it has been saved.")}if(!_.isString(newName)){return new AVError(AVError.OTHER_CAUSE,"A role's name must be a String.")}if(!/^[0-9a-zA-Z\-_ ]+$/.test(newName)){return new AVError(AVError.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}}if(AV.Object.prototype.validate){return AV.Object.prototype.validate.call(this,attrs,options)}return false}})}},{"./error":34,"underscore":21}],51:[function(require,module,exports){var _=require('underscore');var AVRequest=require('./request').request;module.exports=function(AV){AV.SearchSortBuilder=function(){this._sortFields=[]};AV.SearchSortBuilder.prototype={_addField:function _addField(key,order,mode,missing){var field={};field[key]={order:order||'asc',mode:mode||'avg',missing:'_'+(missing||'last')};this._sortFields.push(field);return this},ascending:function ascending(key,mode,missing){return this._addField(key,'asc',mode,missing)},descending:function descending(key,mode,missing){return this._addField(key,'desc',mode,missing)},whereNear:function whereNear(key,point,options){options=options||{};var field={};var geo={lat:point.latitude,lon:point.longitude};var m={order:options.order||'asc',mode:options.mode||'avg',unit:options.unit||'km'};m[key]=geo;field['_geo_distance']=m;this._sortFields.push(field);return this},build:function build(){return JSON.stringify(AV._encode(this._sortFields))}};AV.SearchQuery=AV.Query._extend({_sid:null,_hits:0,_queryString:null,_highlights:null,_sortBuilder:null,_createRequest:function _createRequest(params,options){return AVRequest('search/select',null,null,'GET',params||this.toJSON(),options)},sid:function sid(_sid){this._sid=_sid;return this},queryString:function queryString(q){this._queryString=q;return this},highlights:function highlights(_highlights){var objects;if(_highlights&&_.isString(_highlights)){objects=arguments}else{objects=_highlights}this._highlights=objects;return this},sortBy:function sortBy(builder){this._sortBuilder=builder;return this},hits:function hits(){if(!this._hits){this._hits=0}return this._hits},_processResult:function _processResult(json){delete json['className'];delete json['_app_url'];delete json['_deeplink'];return json},hasMore:function hasMore(){return!this._hitEnd},reset:function reset(){this._hitEnd=false;this._sid=null;this._hits=0},find:function find(){var self=this;var request=this._createRequest();return request.then(function(response){if(response.sid){self._oldSid=self._sid;self._sid=response.sid}else{self._sid=null;self._hitEnd=true}self._hits=response.hits||0;return _.map(response.results,function(json){if(json.className){response.className=json.className}var obj=self._newObject(response);obj.appURL=json['_app_url'];obj._finishFetch(self._processResult(json),true);return obj})})},toJSON:function toJSON(){var params=AV.SearchQuery.__super__.toJSON.call(this);delete params.where;if(this.className){params.clazz=this.className}if(this._sid){params.sid=this._sid}if(!this._queryString){throw'Please set query string.';}else{params.q=this._queryString}if(this._highlights){params.highlights=this._highlights.join(',')}if(this._sortBuilder&&params.order){throw'sort and order can not be set at same time.';}if(this._sortBuilder){params.sort=this._sortBuilder.build()}return params}})}},{"./request":49,"underscore":21}],52:[function(require,module,exports){var _=require('underscore');var AVRequest=require('./request').request;var getUser=function getUser(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return AV.User.currentAsync().then(function(currUser){return currUser?currUser:AV.User._fetchUserBySessionToken(options.sessionToken)})};var getUserPointer=function getUserPointer(options){return getUser(options).then(function(currUser){return AV.Object.createWithoutData('_User',currUser.id)._toPointer()})};module.exports=function(AV){AV.Status=function(imageUrl,message){this.data={};this.inboxType='default';this.query=null;if(imageUrl&&(typeof imageUrl==="undefined"?"undefined":_typeof(imageUrl))==='object'){this.data=imageUrl}else{if(imageUrl){this.data.image=imageUrl}if(message){this.data.message=message}}return this};AV.Status.prototype={get:function get(attr){return this.data[attr]},set:function set(key,value){this.data[key]=value;return this},destroy:function destroy(options){if(!this.id)return AV.Promise.reject(new Error('The status id is not exists.'));var request=AVRequest('statuses',null,this.id,'DELETE',options&&options.sessionToken);return request},toObject:function toObject(){if(!this.id)return null;return AV.Object.createWithoutData('_Status',this.id)},_getDataJSON:function _getDataJSON(){var json=_.clone(this.data);return AV._encode(json)},send:function send(){var _this9=this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!options.sessionToken&&!AV.User.current()){throw new Error('Please signin an user.');}if(!this.query){return AV.Status.sendStatusToFollowers(this,options)}return getUserPointer(options).then(function(currUser){var query=_this9.query.toJSON();query.className=_this9.query.className;var data={};data.query=query;_this9.data=_this9.data||{};_this9.data.source=_this9.data.source||currUser;data.data=_this9._getDataJSON();data.inboxType=_this9.inboxType||'default';return AVRequest('statuses',null,null,'POST',data,options.sessionToken)}).then(function(response){_this9.id=response.objectId;_this9.createdAt=AV._parseDate(response.createdAt);return _this9})},_finishFetch:function _finishFetch(serverData){this.id=serverData.objectId;this.createdAt=AV._parseDate(serverData.createdAt);this.updatedAt=AV._parseDate(serverData.updatedAt);this.messageId=serverData.messageId;delete serverData.messageId;delete serverData.objectId;delete serverData.createdAt;delete serverData.updatedAt;this.data=AV._decode(undefined,serverData)}};AV.Status.sendStatusToFollowers=function(status){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!options.sessionToken&&!AV.User.current()){throw new Error('Please signin an user.');}return getUserPointer(options).then(function(currUser){var query={};query.className='_Follower';query.keys='follower';query.where={user:currUser};var data={};data.query=query;status.data=status.data||{};status.data.source=status.data.source||currUser;data.data=status._getDataJSON();data.inboxType=status.inboxType||'default';var request=AVRequest('statuses',null,null,'POST',data,options.sessionToken);return request.then(function(response){status.id=response.objectId;status.createdAt=AV._parseDate(response.createdAt);return status})})};AV.Status.sendPrivateStatus=function(status,target){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!options.sessionToken&&!AV.User.current()){throw new Error('Please signin an user.');}if(!target){throw new Error("Invalid target user.");}var userObjectId=_.isString(target)?target:target.id;if(!userObjectId){throw new Error("Invalid target user.");}return getUserPointer(options).then(function(currUser){var query={};query.className='_User';query.where={objectId:userObjectId};var data={};data.query=query;status.data=status.data||{};status.data.source=status.data.source||currUser;data.data=status._getDataJSON();data.inboxType='private';status.inboxType='private';var request=AVRequest('statuses',null,null,'POST',data,options.sessionToken);return request.then(function(response){status.id=response.objectId;status.createdAt=AV._parseDate(response.createdAt);return status})})};AV.Status.countUnreadStatuses=function(owner){var options=(!_.isString(arguments[1])?arguments[1]:arguments[2])||{};var inboxType=!_.isString(arguments[1])?'default':arguments[1];if(!options.sessionToken&&owner==null&&!AV.User.current()){throw new Error('Please signin an user or pass the owner objectId.');}return getUser(options).then(function(owner){var params={};params.inboxType=AV._encode(inboxType);params.owner=AV._encode(owner);return AVRequest('subscribe/statuses/count',null,null,'GET',params,options.sessionToken)})};AV.Status.statusQuery=function(source){var query=new AV.Query('_Status');if(source){query.equalTo('source',source)}return query};AV.InboxQuery=AV.Query._extend({_objectClass:AV.Status,_sinceId:0,_maxId:0,_inboxType:'default',_owner:null,_newObject:function _newObject(){return new AV.Status()},_createRequest:function _createRequest(params,options){return AVRequest('subscribe/statuses',null,null,'GET',params||this.toJSON(),options&&options.sessionToken)},sinceId:function sinceId(id){this._sinceId=id;return this},maxId:function maxId(id){this._maxId=id;return this},owner:function owner(_owner){this._owner=_owner;return this},inboxType:function inboxType(type){this._inboxType=type;return this},toJSON:function toJSON(){var params=AV.InboxQuery.__super__.toJSON.call(this);params.owner=AV._encode(this._owner);params.inboxType=AV._encode(this._inboxType);params.sinceId=AV._encode(this._sinceId);params.maxId=AV._encode(this._maxId);return params}});AV.Status.inboxQuery=function(owner,inboxType){var query=new AV.InboxQuery(AV.Status);if(owner){query._owner=owner}if(inboxType){query._inboxType=inboxType}return query}}},{"./request":49,"underscore":21}],53:[function(require,module,exports){var request=require('superagent');var debug=require('debug')('cos');var Promise=require('../promise');module.exports=function upload(uploadInfo,data,file){var saveOptions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};file.attributes.url=uploadInfo.url;file._bucket=uploadInfo.bucket;file.id=uploadInfo.objectId;var uploadUrl=uploadInfo.upload_url+"?sign="+encodeURIComponent(uploadInfo.token);return new Promise(function(resolve,reject){var req=request('POST',uploadUrl).field('fileContent',data).field('op','upload');if(saveOptions.onprogress){req.on('progress',saveOptions.onprogress)}req.end(function(err,res){if(res){debug(res.status,res.body,res.text)}if(err){if(res){err.statusCode=res.status;err.responseText=res.text;err.response=res.body}return reject(err)}resolve(file)})})}},{"../promise":45,"debug":5,"superagent":17}],54:[function(require,module,exports){var request=require('superagent');var Promise=require('../promise');var debug=require('debug')('qiniu');module.exports=function upload(uploadInfo,data,file){var saveOptions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};file.attributes.url=uploadInfo.url;file._bucket=uploadInfo.bucket;file.id=uploadInfo.objectId;var uptoken=uploadInfo.token;return new Promise(function(resolve,reject){var req=request('POST','https://up.qbox.me').field('file',data).field('name',file.attributes.name).field('key',file._qiniu_key).field('token',uptoken);if(saveOptions.onprogress){req.on('progress',saveOptions.onprogress)}req.end(function(err,res){if(res){debug(res.status,res.body,res.text)}if(err){if(res){err.statusCode=res.status;err.responseText=res.text;err.response=res.body}return reject(err)}resolve(file)})})}},{"../promise":45,"debug":5,"superagent":17}],55:[function(require,module,exports){var request=require('superagent');var AVPromise=require('../promise');module.exports=function upload(uploadInfo,data,file){var saveOptions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};file.attributes.url=uploadInfo.url;file._bucket=uploadInfo.bucket;file.id=uploadInfo.objectId;return new Promise(function(resolve,reject){var req=request('PUT',uploadInfo.upload_url).set('Content-Type',file.attributes.metaData.mime_type).send(data);if(saveOptions.onprogress){req.on('progress',saveOptions.onprogress)}req.end(function(err,res){if(err){if(res){err.statusCode=res.status;err.responseText=res.text;err.response=res.body}return reject(err)}resolve(file)})})}},{"../promise":45,"superagent":17}],56:[function(require,module,exports){var _=require('underscore');var AVError=require('./error');var AVRequest=require('./request').request;var Promise=require('./promise');var getWeappLoginCode=function getWeappLoginCode(){if(typeof wx==='undefined'||typeof wx.login!=='function'){throw new Error('Weapp Login is only available in Weapp');}return new Promise(function(resolve,reject){wx.login({success:function success(_ref2){var code=_ref2.code,errMsg=_ref2.errMsg;if(code){resolve(code)}else{reject(new Error(errMsg))}}})})};module.exports=function(AV){AV.User=AV.Object.extend("_User",{_isCurrentUser:false,_mergeMagicFields:function _mergeMagicFields(attrs){if(attrs.sessionToken){this._sessionToken=attrs.sessionToken;delete attrs.sessionToken}AV.User.__super__._mergeMagicFields.call(this,attrs)},_cleanupAuthData:function _cleanupAuthData(){if(!this.isCurrent()){return}var authData=this.get('authData');if(!authData){return}AV._objectEach(this.get('authData'),function(value,key){if(!authData[key]){delete authData[key]}})},_synchronizeAllAuthData:function _synchronizeAllAuthData(){var authData=this.get('authData');if(!authData){return}var self=this;AV._objectEach(this.get('authData'),function(value,key){self._synchronizeAuthData(key)})},_synchronizeAuthData:function _synchronizeAuthData(provider){if(!this.isCurrent()){return}var authType;if(_.isString(provider)){authType=provider;provider=AV.User._authProviders[authType]}else{authType=provider.getAuthType()}var authData=this.get('authData');if(!authData||!provider){return}var success=provider.restoreAuthentication(authData[authType]);if(!success){this._unlinkFrom(provider)}},_handleSaveResult:function _handleSaveResult(makeCurrent){if(makeCurrent&&!AV._config.disableCurrentUser){this._isCurrentUser=true}this._cleanupAuthData();this._synchronizeAllAuthData();delete this._serverData.password;this._rebuildEstimatedDataForKey("password");this._refreshCache();if((makeCurrent||this.isCurrent())&&!AV._config.disableCurrentUser){return Promise.resolve(AV.User._saveCurrentUser(this))}else{return Promise.resolve()}},_linkWith:function _linkWith(provider,data){var _this10=this;var authType;if(_.isString(provider)){authType=provider;provider=AV.User._authProviders[provider]}else{authType=provider.getAuthType()}if(data){var authData=this.get('authData')||{};authData[authType]=data;return this.save({authData:authData}).then(function(model){return model._handleSaveResult(true).then(function(){return model})})}else{return provider.authenticate().then(function(result){return _this10._linkWith(provider,result)})}},linkWithWeapp:function linkWithWeapp(){var _this11=this;return getWeappLoginCode().then(function(code){return _this11._linkWith('lc_weapp',{code:code})})},_unlinkFrom:function _unlinkFrom(provider){var _this12=this;if(_.isString(provider)){provider=AV.User._authProviders[provider]}return this._linkWith(provider,null).then(function(model){_this12._synchronizeAuthData(provider);return model})},_isLinked:function _isLinked(provider){var authType;if(_.isString(provider)){authType=provider}else{authType=provider.getAuthType()}var authData=this.get('authData')||{};return!!authData[authType]},logOut:function logOut(){this._logOutWithAll();this._isCurrentUser=false},_logOutWithAll:function _logOutWithAll(){var authData=this.get('authData');if(!authData){return}var self=this;AV._objectEach(this.get('authData'),function(value,key){self._logOutWith(key)})},_logOutWith:function _logOutWith(provider){if(!this.isCurrent()){return}if(_.isString(provider)){provider=AV.User._authProviders[provider]}if(provider&&provider.deauthenticate){provider.deauthenticate()}},signUp:function signUp(attrs,options){var error;var username=attrs&&attrs.username||this.get("username");if(!username||username===""){error=new AVError(AVError.OTHER_CAUSE,"Cannot sign up user with an empty name.");throw error;}var password=attrs&&attrs.password||this.get("password");if(!password||password===""){error=new AVError(AVError.OTHER_CAUSE,"Cannot sign up user with an empty password.");throw error;}return this.save(attrs,options).then(function(model){return model._handleSaveResult(true).then(function(){return model})})},signUpOrlogInWithMobilePhone:function signUpOrlogInWithMobilePhone(attrs){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var error;var mobilePhoneNumber=attrs&&attrs.mobilePhoneNumber||this.get("mobilePhoneNumber");if(!mobilePhoneNumber||mobilePhoneNumber===""){error=new AVError(AVError.OTHER_CAUSE,"Cannot sign up or login user by mobilePhoneNumber with an empty mobilePhoneNumber.");throw error;}var smsCode=attrs&&attrs.smsCode||this.get("smsCode");if(!smsCode||smsCode===""){error=new AVError(AVError.OTHER_CAUSE,"Cannot sign up or login user by mobilePhoneNumber  with an empty smsCode.");throw error;}options._makeRequest=function(route,className,id,method,json){return AVRequest('usersByMobilePhone',null,null,"POST",json)};return this.save(attrs,options).then(function(model){delete model.attributes.smsCode;delete model._serverData.smsCode;return model._handleSaveResult(true).then(function(){return model})})},logIn:function logIn(){var model=this;var request=AVRequest('login',null,null,'POST',this.toJSON());return request.then(function(resp){var serverAttrs=model.parse(resp);model._finishFetch(serverAttrs);return model._handleSaveResult(true).then(function(){if(!serverAttrs.smsCode)delete model.attributes['smsCode'];return model})})},save:function save(arg1,arg2,arg3){var i,attrs,current,options,saved;if(_.isObject(arg1)||_.isNull(arg1)||_.isUndefined(arg1)){attrs=arg1;options=arg2}else{attrs={};attrs[arg1]=arg2;options=arg3}options=options||{};return AV.Object.prototype.save.call(this,attrs,options).then(function(model){return model._handleSaveResult(false).then(function(){return model})})},follow:function follow(target,options){if(!this.id){throw"Please signin.";}if(!target){throw"Invalid target user.";}var userObjectId=_.isString(target)?target:target.id;if(!userObjectId){throw"Invalid target user.";}var route='users/'+this.id+'/friendship/'+userObjectId;var request=AVRequest(route,null,null,'POST',null,options);return request},unfollow:function unfollow(target,options){if(!this.id){throw"Please signin.";}if(!target){throw"Invalid target user.";}var userObjectId=_.isString(target)?target:target.id;if(!userObjectId){throw"Invalid target user.";}var route='users/'+this.id+'/friendship/'+userObjectId;var request=AVRequest(route,null,null,'DELETE',null,options);return request},followerQuery:function followerQuery(){return AV.User.followerQuery(this.id)},followeeQuery:function followeeQuery(){return AV.User.followeeQuery(this.id)},fetch:function fetch(fetchOptions,options){return AV.Object.prototype.fetch.call(this,fetchOptions,options).then(function(model){return model._handleSaveResult(false).then(function(){return model})})},updatePassword:function updatePassword(oldPassword,newPassword,options){var route='users/'+this.id+'/updatePassword';var params={old_password:oldPassword,new_password:newPassword};var request=AVRequest(route,null,null,'PUT',params,options);return request},isCurrent:function isCurrent(){return this._isCurrentUser},getUsername:function getUsername(){return this.get("username")},getMobilePhoneNumber:function getMobilePhoneNumber(){return this.get("mobilePhoneNumber")},setMobilePhoneNumber:function setMobilePhoneNumber(phone,options){return this.set("mobilePhoneNumber",phone,options)},setUsername:function setUsername(username,options){return this.set("username",username,options)},setPassword:function setPassword(password,options){return this.set("password",password,options)},getEmail:function getEmail(){return this.get("email")},setEmail:function setEmail(email,options){return this.set("email",email,options)},authenticated:function authenticated(){console.warn('DEPRECATED:  currentUser.isAuthenticated().then() user.id === currentUser.id');return!!this._sessionToken&&!AV._config.disableCurrentUser&&AV.User.current()&&AV.User.current().id===this.id},isAuthenticated:function isAuthenticated(){var _this13=this;return Promise.resolve().then(function(){return!!_this13._sessionToken&&AV.User._fetchUserBySessionToken(_this13._sessionToken).then(function(){return true},function(error){if(error.code===211){return false}throw error;})})},getSessionToken:function getSessionToken(){return this._sessionToken},getRoles:function getRoles(options){return AV.Relation.reverseQuery("_Role","users",this).find(options)}},{_currentUser:null,_currentUserMatchesDisk:false,_CURRENT_USER_KEY:"currentUser",_authProviders:{},signUp:function signUp(username,password,attrs,options){attrs=attrs||{};attrs.username=username;attrs.password=password;var user=AV.Object._create("_User");return user.signUp(attrs,options)},logIn:function logIn(username,password,options){var user=AV.Object._create("_User");user._finishFetch({username:username,password:password});return user.logIn(options)},become:function become(sessionToken){return this._fetchUserBySessionToken(sessionToken).then(function(user){return user._handleSaveResult(true).then(function(){return user})})},_fetchUserBySessionToken:function _fetchUserBySessionToken(sessionToken){var user=AV.Object._create("_User");return AVRequest("users","me",null,"GET",{session_token:sessionToken}).then(function(resp){var serverAttrs=user.parse(resp);user._finishFetch(serverAttrs);return user})},logInWithMobilePhoneSmsCode:function logInWithMobilePhoneSmsCode(mobilePhone,smsCode,options){var user=AV.Object._create("_User");user._finishFetch({mobilePhoneNumber:mobilePhone,smsCode:smsCode});return user.logIn(options)},signUpOrlogInWithMobilePhone:function signUpOrlogInWithMobilePhone(mobilePhoneNumber,smsCode,attrs,options){attrs=attrs||{};attrs.mobilePhoneNumber=mobilePhoneNumber;attrs.smsCode=smsCode;var user=AV.Object._create("_User");return user.signUpOrlogInWithMobilePhone(attrs,options)},logInWithMobilePhone:function logInWithMobilePhone(mobilePhone,password,options){var user=AV.Object._create("_User");user._finishFetch({mobilePhoneNumber:mobilePhone,password:password});return user.logIn(options)},signUpOrlogInWithAuthData:function signUpOrlogInWithAuthData(authData,platform){return AV.User._logInWith(platform,authData)},loginWithWeapp:function loginWithWeapp(){var _this14=this;return getWeappLoginCode().then(function(code){return _this14.signUpOrlogInWithAuthData({code:code},'lc_weapp')})},associateWithAuthData:function associateWithAuthData(userObj,platform,authData){return userObj._linkWith(platform,authData)},logOut:function logOut(){if(AV._config.disableCurrentUser){console.warn('AV.User.current() was disabled in multi-user environment, call logOut() from user object instead https://leancloud.cn/docs/leanengine-node-sdk-upgrade-1.html');return Promise.resolve(null)}if(AV.User._currentUser!==null){AV.User._currentUser._logOutWithAll();AV.User._currentUser._isCurrentUser=false}AV.User._currentUserMatchesDisk=true;AV.User._currentUser=null;return AV.localStorage.removeItemAsync(AV._getAVPath(AV.User._CURRENT_USER_KEY))},followerQuery:function followerQuery(userObjectId){if(!userObjectId||!_.isString(userObjectId)){throw"Invalid user object id.";}var query=new AV.FriendShipQuery('_Follower');query._friendshipTag='follower';query.equalTo('user',AV.Object.createWithoutData('_User',userObjectId));return query},followeeQuery:function followeeQuery(userObjectId){if(!userObjectId||!_.isString(userObjectId)){throw"Invalid user object id.";}var query=new AV.FriendShipQuery('_Followee');query._friendshipTag='followee';query.equalTo('user',AV.Object.createWithoutData('_User',userObjectId));return query},requestPasswordReset:function requestPasswordReset(email){var json={email:email};var request=AVRequest("requestPasswordReset",null,null,"POST",json);return request},requestEmailVerify:function requestEmailVerify(email){var json={email:email};var request=AVRequest("requestEmailVerify",null,null,"POST",json);return request},requestMobilePhoneVerify:function requestMobilePhoneVerify(mobilePhone){var json={mobilePhoneNumber:mobilePhone};var request=AVRequest("requestMobilePhoneVerify",null,null,"POST",json);return request},requestPasswordResetBySmsCode:function requestPasswordResetBySmsCode(mobilePhone){var json={mobilePhoneNumber:mobilePhone};var request=AVRequest("requestPasswordResetBySmsCode",null,null,"POST",json);return request},resetPasswordBySmsCode:function resetPasswordBySmsCode(code,password){var json={password:password};var request=AVRequest("resetPasswordBySmsCode",null,code,"PUT",json);return request},verifyMobilePhone:function verifyMobilePhone(code){var request=AVRequest("verifyMobilePhone",null,code,"POST",null);return request},requestLoginSmsCode:function requestLoginSmsCode(mobilePhone){var json={mobilePhoneNumber:mobilePhone};var request=AVRequest("requestLoginSmsCode",null,null,"POST",json);return request},currentAsync:function currentAsync(){if(AV._config.disableCurrentUser){console.warn('AV.User.currentAsync() was disabled in multi-user environment, access user from request instead https://leancloud.cn/docs/leanengine-node-sdk-upgrade-1.html');return Promise.resolve(null)}if(AV.User._currentUser){return Promise.resolve(AV.User._currentUser)}if(AV.User._currentUserMatchesDisk){return Promise.resolve(AV.User._currentUser)}return AV.localStorage.getItemAsync(AV._getAVPath(AV.User._CURRENT_USER_KEY)).then(function(userData){if(!userData){return null}AV.User._currentUserMatchesDisk=true;AV.User._currentUser=AV.Object._create("_User");AV.User._currentUser._isCurrentUser=true;var json=JSON.parse(userData);AV.User._currentUser.id=json._id;delete json._id;AV.User._currentUser._sessionToken=json._sessionToken;delete json._sessionToken;AV.User._currentUser._finishFetch(json);AV.User._currentUser._synchronizeAllAuthData();AV.User._currentUser._refreshCache();AV.User._currentUser._opSetQueue=[{}];return AV.User._currentUser})},current:function current(){if(AV._config.disableCurrentUser){console.warn('AV.User.current() was disabled in multi-user environment, access user from request instead https://leancloud.cn/docs/leanengine-node-sdk-upgrade-1.html');return null}if(AV.User._currentUser){return AV.User._currentUser}if(AV.User._currentUserMatchesDisk){return AV.User._currentUser}AV.User._currentUserMatchesDisk=true;var userData=AV.localStorage.getItem(AV._getAVPath(AV.User._CURRENT_USER_KEY));if(!userData){return null}AV.User._currentUser=AV.Object._create("_User");AV.User._currentUser._isCurrentUser=true;var json=JSON.parse(userData);AV.User._currentUser.id=json._id;delete json._id;AV.User._currentUser._sessionToken=json._sessionToken;delete json._sessionToken;AV.User._currentUser._finishFetch(json);AV.User._currentUser._synchronizeAllAuthData();AV.User._currentUser._refreshCache();AV.User._currentUser._opSetQueue=[{}];return AV.User._currentUser},_saveCurrentUser:function _saveCurrentUser(user){var promise;if(AV.User._currentUser!==user){promise=AV.User.logOut()}else{promise=Promise.resolve()}return promise.then(function(){user._isCurrentUser=true;AV.User._currentUser=user;var json=user.toJSON();json._id=user.id;json._sessionToken=user._sessionToken;return AV.localStorage.setItemAsync(AV._getAVPath(AV.User._CURRENT_USER_KEY),JSON.stringify(json)).then(function(){AV.User._currentUserMatchesDisk=true})})},_registerAuthenticationProvider:function _registerAuthenticationProvider(provider){AV.User._authProviders[provider.getAuthType()]=provider;if(!AV._config.disableCurrentUser&&AV.User.current()){AV.User.current()._synchronizeAuthData(provider.getAuthType())}},_logInWith:function _logInWith(provider,options){var user=AV.Object._create("_User");return user._linkWith(provider,options)}})}},{"./error":34,"./promise":45,"./request":49,"underscore":21}],57:[function(require,module,exports){var _=require('underscore');var isNullOrUndefined=function isNullOrUndefined(x){return _.isNull(x)||_.isUndefined(x)};var ensureArray=function ensureArray(target){if(_.isArray(target)){return target}if(target===undefined||target===null){return[]}return[target]};var getSessionToken=function getSessionToken(authOptions){if(authOptions.sessionToken){return authOptions.sessionToken}if(authOptions.user&&typeof authOptions.user.getSessionToken==='function'){return authOptions.user.getSessionToken()}};module.exports={isNullOrUndefined:isNullOrUndefined,ensureArray:ensureArray,getSessionToken:getSessionToken}},{"underscore":21}],58:[function(require,module,exports){module.exports='js2.0.0-beta.4'},{}]},{},[38])(38)});